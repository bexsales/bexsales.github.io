import{g as qe,k as ke,h as Ae,T as s,M as Fe,r as a,i as Le,a as We,j as e,_ as te,b as Me,f as Ie,x as C,P as _,S as v,C as S,D as R,y as I,z as $,J as $e,G as ze,A as z,N as Re,W as Ne}from"./index-_Be4pJbx.js";import{P as Ue,C as Y}from"./product-view-D5zAQGvU.js";import{D as P,a as w,b as D,c as q,G as F}from"./Grid-BY_q8_1g.js";import{F as N,T,L as Ee}from"./LoadingButton-CFLZsoz2.js";import{C as re}from"./customer-view-DHKSf8N0.js";import{d as Be,e as Qe,b as Ve,T as ee,a as j,f as Ge}from"./search-fill-efGD-N5l.js";import{C as He}from"./Container-DESNEij0.js";import{C as Ze}from"./Card-CB52_33W.js";import{u as Je}from"./use-auth-D4Z8FdWU.js";import"./Select-U2-wU_wk.js";import"./isMuiElement-55VE7sNT.js";const Xe={width:24,height:24,body:'<g id="evaCopyOutline0"><g id="evaCopyOutline1"><g id="evaCopyOutline2" fill="currentColor"><path d="M18 21h-6a3 3 0 0 1-3-3v-6a3 3 0 0 1 3-3h6a3 3 0 0 1 3 3v6a3 3 0 0 1-3 3Zm-6-10a1 1 0 0 0-1 1v6a1 1 0 0 0 1 1h6a1 1 0 0 0 1-1v-6a1 1 0 0 0-1-1Z"/><path d="M9.73 15H5.67A2.68 2.68 0 0 1 3 12.33V5.67A2.68 2.68 0 0 1 5.67 3h6.66A2.68 2.68 0 0 1 15 5.67V9.4h-2V5.67a.67.67 0 0 0-.67-.67H5.67a.67.67 0 0 0-.67.67v6.66a.67.67 0 0 0 .67.67h4.06Z"/></g></g></g>'},Ke=Xe;function Ye(n){return qe("MuiDialogContentText",n)}ke("MuiDialogContentText",["root"]);const et=["children","className"],tt=n=>{const{classes:i}=n,d=Ie({root:["root"]},Ye,i);return te({},i,d)},rt=Ae(s,{shouldForwardProp:n=>Fe(n)||n==="classes",name:"MuiDialogContentText",slot:"Root",overridesResolver:(n,i)=>i.root})({}),ot=a.forwardRef(function(i,c){const d=Le({props:i,name:"MuiDialogContentText"}),{className:u}=d,h=We(d,et),b=tt(h);return e.jsx(rt,te({component:"p",variant:"body1",color:"text.secondary",ref:c,ownerState:h,className:Me(b.root,u)},d,{classes:b}))}),oe=ot;function ne({onSelect:n}){const[i,c]=a.useState(!1),d=()=>{c(!0)},u=()=>{c(!1)},h=b=>{n(b),u()};return e.jsxs("div",{children:[e.jsx(C,{variant:"outlined",onClick:d,children:"Add Product"}),e.jsxs(P,{open:i,onClose:u,maxWidth:"xl",fullWidth:!0,children:[e.jsx(w,{children:"Products"}),e.jsx(D,{children:e.jsx(N,{sx:{width:"100%"},children:e.jsx(Ue,{onSelect:h,style:{width:"100%"}})})}),e.jsx(q,{children:e.jsx(C,{onClick:u,color:"primary",children:"Close"})})]})]})}ne.propTypes={onSelect:_.func};function ae({handleSendOrder:n,partner:i}){const[c,d]=a.useState(!1),u=()=>{d(!0)},h=()=>{d(!1)};return e.jsxs(v,{direction:"row",alignItems:"center",children:[e.jsxs(v,{direction:"column",alignItems:"center",spacing:1,children:[e.jsx(S,{onClick:u,sx:{color:"blue",backgroundColor:"#ddf","&:hover":{backgroundColor:"#bbf"}},children:e.jsx(R,{icon:"mdi:send"})}),e.jsx(s,{variant:"caption",sx:{color:"blue"},children:"Email"})]}),e.jsxs(P,{open:c,onClose:h,"aria-labelledby":"alert-dialog-title","aria-describedby":"alert-dialog-description",children:[e.jsx(w,{id:"alert-dialog-title",children:"Confirm Send"}),e.jsx(D,{children:e.jsxs(oe,{id:"alert-dialog-description",children:["Are you sure you want to send this order to ",e.jsxs("b",{children:[i.name," [",i.email,"]"]}),"?"]})}),e.jsxs(q,{children:[e.jsx(C,{onClick:h,color:"primary",children:"Cancel"}),e.jsx(C,{onClick:n,color:"primary",autoFocus:!0,children:"Confirm"})]})]})]})}ae.propTypes={handleSendOrder:_.func,partner:_.any};function se({onSelect:n}){const[i,c]=a.useState(!1),d=()=>{c(!0)},u=()=>{c(!1)},h=b=>{n(b),u()};return e.jsxs("div",{children:[e.jsx(C,{variant:"outlined",onClick:d,children:"Set"}),e.jsxs(P,{open:i,onClose:u,maxWidth:"xl",fullWidth:!0,children:[e.jsx(w,{children:"Customers"}),e.jsx(D,{sx:{padding:0},children:e.jsx(N,{sx:{width:"100%"},children:e.jsx(re,{onSelect:h,style:{width:"100%"}})})}),e.jsx(q,{children:e.jsx(C,{onClick:u,color:"primary",children:"Close"})})]})]})}se.propTypes={onSelect:_.func};function ie({onSelect:n,filterParentContactOption:i}){const[c,d]=a.useState(!1),u=()=>{d(!0)},h=()=>{d(!1)},b=l=>{n(l),h()};return a.useEffect(()=>{console.log("DeliveryPopupModal Props:"),console.log("filterParentContactOption:",i)},[n,i]),e.jsxs("div",{children:[e.jsx(C,{variant:"outlined",onClick:u,children:"Set"}),e.jsxs(P,{open:c,onClose:h,maxWidth:"xl",fullWidth:!0,children:[e.jsx(w,{children:"Customers"}),e.jsx(D,{sx:{padding:0},children:e.jsx(N,{sx:{width:"100%"},children:e.jsx(re,{onSelect:b,filterTypeOption:"delivery",filterParentContactOption:i,style:{width:"100%"}})})}),e.jsx(q,{children:e.jsx(C,{onClick:h,color:"primary",children:"Close"})})]})]})}ie.propTypes={onSelect:_.func,filterParentContactOption:_.number};function le({handleCancelOrder:n}){const[i,c]=a.useState(!1),d=()=>{c(!0)},u=()=>{c(!1)};return e.jsxs(v,{direction:"row",alignItems:"center",children:[e.jsxs(v,{direction:"column",alignItems:"center",spacing:1,children:[e.jsx(S,{onClick:d,sx:{color:"red",backgroundColor:"#fdd","&:hover":{backgroundColor:"#fbb"}},children:e.jsx(R,{icon:"eva:close-outline"})}),e.jsx(s,{variant:"caption",sx:{color:"red"},children:"Cancel"})]}),e.jsxs(P,{open:i,onClose:u,"aria-labelledby":"alert-dialog-title","aria-describedby":"alert-dialog-description",children:[e.jsx(w,{id:"alert-dialog-title",children:"Confirm Cancellation"}),e.jsx(D,{children:e.jsx(oe,{id:"alert-dialog-description",children:"Are you sure you want to cancel this order?"})}),e.jsxs(q,{children:[e.jsx(C,{onClick:u,color:"primary",children:"Cancel"}),e.jsx(C,{onClick:n,color:"primary",autoFocus:!0,children:"Confirm"})]})]})]})}le.propTypes={handleCancelOrder:_.func};function de({orderId:n}){const[i,c]=a.useState(!1),[d,u]=a.useState(""),[h,b]=a.useState(""),[l,U]=a.useState({id:0,name:"",street:"",city:"",state:"",country:"",zip:"",phone:"",mobile:"",email:""}),[f,L]=a.useState({id:0,name:"",street:"",city:"",state:"",country:"",zip:"",phone:"",mobile:"",email:""}),[g,k]=a.useState([]),[E,ce]=a.useState([]),[B,ue]=a.useState({}),[he,Q]=a.useState(0),[pe,V]=a.useState(0),[xe,je]=a.useState(0),[G,H]=a.useState(""),[Z,J]=a.useState(""),[W,me]=a.useState(""),[X,ge]=a.useState("");a.useEffect(()=>{Oe()},[]);const ye=()=>{M(!0,!1)},be=()=>{M(!1,!0)},fe=(t,r)=>{console.log("Fetching order totals");const p=`${z.baseURL}/api-proxy/proxy?method=post&resource=ordertotals`;console.log(p);const o=g.map(x=>({product_id:x[2].id,product_uom_qty:x[2].product_uom_qty})),y={partner_id:l.id,order_line:o};console.log("Request body",y),I.post(p,y,{headers:{Authorization:`Bearer ${$.get("jwt")}`}}).then(x=>{console.log(x.data),ue(x.data.result.product_prices),Q(x.data.result.subtotal),V(x.data.result.total)}).catch(x=>{console.error("Error fetching order totals:",x)})};a.useEffect(()=>{fe();const t=g.reduce((r,p)=>r+p[2].product_uom_qty,0);je(t)},[l,g]);const Ce=t=>{H(t.target.value)},ve=t=>{J(t.target.value)},M=(t,r)=>{c(!0),console.log("Saving Order");let p="post";t===!0&&(p="cancel");const o=`${z.baseURL}/api-proxy/proxy?method=${p}&resource=orders`;console.log(o),console.log(g);const y=g.map(m=>[m[0],m[1],{product_id:m[2].id,product_uom_qty:m[2].product_uom_qty}]),x=E.map(m=>[2,m[1],{}]),O=y.concat(x),K={order:{id:parseInt(n,10),partner_id:l.id,order_line:O,x_studio_notes:G,client_order_ref:Z,...r&&{is_send:!0},...f.id&&{partner_shipping_id:f.id}}};console.log("Request body",K),I.post(o,K,{headers:{Authorization:`Bearer ${$.get("jwt")}`}}).then(m=>{console.log(m.data),c(!1),m.data.result.success===!1?alert(m.data.result.message):window.location.reload()}).catch(m=>{console.error("Error saving order:",m)})},_e=(t,r,p)=>{if(t<0||t>=g.length)return;const o=g.filter((x,O)=>O===t);o[0][0]!==0&&(console.log("Adding line to delete queue",o),ce(E.concat(o)));const y=g.filter((x,O)=>O!==t);k(y)},Se=(t,r)=>{const p=g.map((o,y)=>{if(y===t){console.log("handle qty change",o);const x=["consu","service"];return o[2].qty_available<r&&!x.includes(o[2].type)?(alert("Quantity available is insufficient."),o):[o[0],o[1],{...o[2],product_uom_qty:r!==0?Number(r):0}]}return o});k(p)},A=t=>t?`$${t.toFixed(2)}`:"",Oe=()=>{console.log("Fetching Order Details");const t=`${z.baseURL}/api-proxy/proxy?method=get&resource=orders&order_id=${n}`;console.log(t),I.get(t,{headers:{Authorization:`Bearer ${$.get("jwt")}`}}).then(r=>{console.log(r.data.data),u(r.data.data.name),me(r.data.data.ship_tracking_number),ge(r.data.data.ship_date),U(r.data.data.customer_id),L(r.data.data.partner_shipping_id),H(r.data.data.x_studio_notes),J(r.data.data.client_order_ref?r.data.data.client_order_ref:"");const p=r.data.data.order_line.map(o=>[1,o.id,{line_id:o.id,id:o.product_id.id,name:o.name,product_uom_qty:o.product_uom_qty,attributes:o.product_id.attributes.map(y=>`${y.attribute}:${y.name}`),qty_available:o.product_id.qty_available,type:o.product_id.type}]);console.log(p),k(p),Q(r.data.data.amount_untaxed),V(r.data.data.amount_total),b(r.data.data.state)}).catch(r=>{console.error("Error fetching order details:",r)})},Te=t=>{console.log("Setting order partner"),console.log(t),U({id:t.id,name:t.name,street:t.street,city:t.city,state:t.state,country:t.country,zip:t.zip,phone:t.phone,mobile:t.mobile,email:t.email}),L({id:0,name:"",street:"",city:"",state:"",country:"",zip:"",phone:"",mobile:"",email:""})},Pe=t=>{console.log("Setting order partner"),console.log(t),L({id:t.id,name:t.name,street:t.street,city:t.city,state:t.state,country:t.country,zip:t.zip,phone:t.phone,mobile:t.mobile,email:t.email})},we=t=>{console.log("Adding order line"),console.log(t);const r=["consu","service"];t.qty_available<1&&!r.includes(t.type)?alert("Cannot add product lines with 0 qty available"):k([...g,[0,0,{id:t.id,name:`[${t.default_code}] ${t.name}`,product_uom_qty:1,attributes:t.attributes,qty_available:t.qty_available}]])},De=e.jsxs(e.Fragment,{children:[e.jsx(v,{spacing:3,direction:"row",alignItems:"center",children:e.jsx(T,{fullWidth:!0,name:"partner_id",label:"Customer",value:l.name,InputProps:{readOnly:!0,endAdornment:e.jsx(S,{children:e.jsx(se,{onSelect:Te})})}})}),l.name&&e.jsxs(e.Fragment,{children:[e.jsx("div",{style:{margin:"16px 0"}}),e.jsx(s,{variant:"body1",fontWeight:"bold",children:"Address:"}),e.jsx(s,{variant:"body1",children:l.street}),e.jsxs(s,{variant:"body1",children:[l.city," ",l.state]}),e.jsxs(s,{variant:"body1",children:[l.country," ",l.zip]}),e.jsxs(s,{variant:"body1",children:[e.jsx("b",{children:"Phone:"})," ",l.phone]}),e.jsxs(s,{variant:"body1",children:[e.jsx("b",{children:"Mobile:"})," ",l.mobile]}),e.jsxs(s,{variant:"body1",children:[e.jsx("b",{children:"Email:"})," ",l.email]})]}),e.jsx("div",{style:{margin:"16px 0"}}),l.name&&e.jsx(v,{spacing:3,direction:"row",alignItems:"center",children:e.jsx(T,{fullWidth:!0,name:"partner_shipping_id",label:"Delivery Address",value:f.name,InputProps:{readOnly:!0,endAdornment:e.jsx(S,{children:e.jsx(ie,{onSelect:Pe,filterParentContactOption:l.id})})}})}),f.name&&e.jsxs(e.Fragment,{children:[e.jsx("div",{style:{margin:"16px 0"}}),e.jsx(s,{variant:"body1",fontWeight:"bold",children:"Address:"}),e.jsx(s,{variant:"body1",children:f.street}),e.jsxs(s,{variant:"body1",children:[f.city," ",l.state]}),e.jsxs(s,{variant:"body1",children:[f.country," ",l.zip]}),e.jsxs(s,{variant:"body1",children:[e.jsx("b",{children:"Phone:"})," ",f.phone]}),e.jsxs(s,{variant:"body1",children:[e.jsx("b",{children:"Mobile:"})," ",f.mobile]}),e.jsxs(s,{variant:"body1",children:[e.jsx("b",{children:"Email:"})," ",f.email]})]}),e.jsx("div",{style:{margin:"16px 0"}}),W&&e.jsxs(e.Fragment,{children:[e.jsx("div",{style:{margin:"16px 0"}}),e.jsxs(s,{variant:"body1",children:[e.jsx("strong",{children:"Tracking #: "}),W,e.jsx(S,{onClick:()=>{navigator.clipboard.writeText(W),alert("Tracking number copied to clipboard!")},children:e.jsx($e,{icon:Ke,sx:{color:"text.disabled",width:20,height:20}})})]})]}),X&&e.jsxs(e.Fragment,{children:[e.jsx("div",{style:{margin:"16px 0"}}),e.jsxs(s,{variant:"body1",children:[e.jsx("strong",{children:"Ship Date: "}),X]})]}),e.jsx("div",{style:{margin:"16px 0"}}),e.jsx(S,{children:e.jsx(ne,{onSelect:we})}),e.jsx("div",{style:{margin:"16px 0"}}),e.jsx(Be,{component:ze,children:e.jsxs(Qe,{children:[e.jsx(Ve,{children:e.jsxs(ee,{children:[e.jsx(j,{children:"Product"}),e.jsx(j,{children:"Attributes"}),e.jsx(j,{children:"Unit Price"}),e.jsx(j,{children:"Qty Available"}),e.jsx(j,{children:"Qty"}),e.jsx(j,{children:"Subtotal"}),e.jsx(j,{})]})}),e.jsx(Ge,{children:g.map((t,r)=>e.jsxs(ee,{children:[e.jsx(j,{children:t[2].name}),e.jsx(j,{children:t[2].attributes.map((p,o)=>e.jsx(Y,{label:p,variant:"outlined"},o))}),e.jsx(j,{children:A(B[t[2].id])}),e.jsx(j,{children:t[2].qty_available}),e.jsx(j,{children:e.jsx(T,{type:"number",style:{minWidth:"100px"},value:t[2].product_uom_qty!==0?t[2].product_uom_qty:"",onChange:p=>Se(r,p.target.value)})}),e.jsx(j,{children:A(B[t[2].id]*t[2].product_uom_qty)}),e.jsx(j,{align:"right",children:e.jsx(S,{onClick:()=>_e(r),children:e.jsx(R,{icon:"eva:trash-2-outline"})})})]},r))})]})}),e.jsx("div",{style:{margin:"16px 0"}}),e.jsxs(s,{variant:"body1",fontWeight:"bold",children:["Total Product Qty: ",xe]}),e.jsxs(s,{variant:"body1",fontWeight:"bold",children:["Subtotal: ",A(he)]}),e.jsxs(s,{variant:"body1",fontWeight:"bold",children:["Total: ",A(pe)]}),e.jsx("div",{style:{margin:"16px 0"}}),e.jsx(F,{container:!0,spacing:2,children:e.jsx(F,{item:!0,xs:12,md:6,lg:6,children:e.jsx(T,{label:"Notes",value:G,multiline:!0,fullWidth:!0,rows:4,onChange:Ce})})}),e.jsx("div",{style:{margin:"16px 0"}}),e.jsx(F,{container:!0,spacing:2,children:e.jsx(F,{item:!0,xs:12,md:6,lg:6,children:e.jsx(T,{label:"PO Number",value:Z,fullWidth:!0,onChange:ve})})}),e.jsx("div",{style:{margin:"16px 0"}}),e.jsx(Ee,{fullWidth:!0,size:"large",type:"submit",variant:"contained",color:"inherit",onClick:M,loading:i,children:"Save"})]});return e.jsxs(He,{children:[e.jsxs(v,{direction:"row",alignItems:"center",justifyContent:"space-between",mb:5,children:[e.jsxs(s,{variant:"h4",children:["Order ",d,e.jsx(Y,{label:h,color:h==="cancel"?"danger":"primary",variant:"outlined",style:{marginLeft:"10px"}})]}),(h==="draft"||h==="sent")&&e.jsxs(v,{direction:"row",spacing:2,children:[e.jsx(le,{handleCancelOrder:ye}),e.jsx(ae,{handleSendOrder:be,partner:l})]})]}),De,e.jsx(Ze,{})]})}de.propTypes={orderId:_.any};function jt(){Je();const{orderId:n}=Re();return e.jsxs(e.Fragment,{children:[e.jsx(Ne,{children:e.jsx("title",{children:" Order Detail | BEX Sales "})}),e.jsx(de,{orderId:n})]})}export{jt as default};
