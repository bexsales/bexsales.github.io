import{j as e,V as z,T as I,P as u,k as X,g as K,r as d,i as Q,t as Se,a4 as Te,a as G,_ as y,h as N,c as M,l as B,d as J,a5 as De,a6 as ke,E as ie,F as re,G as le,S as ce,B as Y,D as ae,H as de,J as Re,X as we,I as We,Y as $e,Z as Ae}from"./index-BiFuz3rn.js";import{T as F,a as g,e as ue,f as pe,b as he,g as xe,c as Ne,d as _e,h as Me}from"./search-fill-CroszyQg.js";import{a as Be,O as Ie}from"./Select-BSvtViZa.js";import{C as ne}from"./Chip-mcDs6DVW.js";import{T as Fe}from"./TextField-CEWYcRfQ.js";import{C as qe}from"./Container-DbbtiuI8.js";import{C as Ee}from"./Card-rz0eWA_E.js";const Oe={border:0,margin:-1,padding:0,width:"1px",height:"1px",overflow:"hidden",position:"absolute",whiteSpace:"nowrap",clip:"rect(0 0 0 0)"};function Ue(t,a,o){return t?Math.max(0,(1+t)*a-o):0}function ge({query:t}){return e.jsx(F,{children:e.jsx(g,{align:"center",colSpan:6,sx:{py:3},children:e.jsxs(z,{sx:{textAlign:"center"},children:[e.jsx(I,{variant:"h6",paragraph:!0,children:"Not found"}),e.jsxs(I,{variant:"body2",children:["No results found for Â ",e.jsxs("strong",{children:['"',t,'"']}),".",e.jsx("br",{})," Try checking for typos or using complete words."]})]})})})}ge.propTypes={query:u.string};function me({emptyRows:t,height:a}){return t?e.jsx(F,{sx:{...a&&{height:a*t}},children:e.jsx(g,{colSpan:9})}):null}me.propTypes={emptyRows:u.number,height:u.number};function Ve(t){return K("MuiDialog",t)}const oe=X("MuiDialog",["root","scrollPaper","scrollBody","container","paper","paperScrollPaper","paperScrollBody","paperWidthFalse","paperWidthXs","paperWidthSm","paperWidthMd","paperWidthLg","paperWidthXl","paperFullWidth","paperFullScreen"]),fe=d.createContext({}),He=["aria-describedby","aria-labelledby","BackdropComponent","BackdropProps","children","className","disableEscapeKeyDown","fullScreen","fullWidth","maxWidth","onBackdropClick","onClose","open","PaperComponent","PaperProps","scroll","TransitionComponent","transitionDuration","TransitionProps"],Le=N(ke,{name:"MuiDialog",slot:"Backdrop",overrides:(t,a)=>a.backdrop})({zIndex:-1}),Ye=t=>{const{classes:a,scroll:o,maxWidth:c,fullWidth:i,fullScreen:n}=t,p={root:["root"],container:["container",`scroll${B(o)}`],paper:["paper",`paperScroll${B(o)}`,`paperWidth${B(String(c))}`,i&&"paperFullWidth",n&&"paperFullScreen"]};return J(p,Ve,a)},ze=N(De,{name:"MuiDialog",slot:"Root",overridesResolver:(t,a)=>a.root})({"@media print":{position:"absolute !important"}}),Xe=N("div",{name:"MuiDialog",slot:"Container",overridesResolver:(t,a)=>{const{ownerState:o}=t;return[a.container,a[`scroll${B(o.scroll)}`]]}})(({ownerState:t})=>y({height:"100%","@media print":{height:"auto"},outline:0},t.scroll==="paper"&&{display:"flex",justifyContent:"center",alignItems:"center"},t.scroll==="body"&&{overflowY:"auto",overflowX:"hidden",textAlign:"center","&:after":{content:'""',display:"inline-block",verticalAlign:"middle",height:"100%",width:"0"}})),Ke=N(z,{name:"MuiDialog",slot:"Paper",overridesResolver:(t,a)=>{const{ownerState:o}=t;return[a.paper,a[`scrollPaper${B(o.scroll)}`],a[`paperWidth${B(String(o.maxWidth))}`],o.fullWidth&&a.paperFullWidth,o.fullScreen&&a.paperFullScreen]}})(({theme:t,ownerState:a})=>y({margin:32,position:"relative",overflowY:"auto","@media print":{overflowY:"visible",boxShadow:"none"}},a.scroll==="paper"&&{display:"flex",flexDirection:"column",maxHeight:"calc(100% - 64px)"},a.scroll==="body"&&{display:"inline-block",verticalAlign:"middle",textAlign:"left"},!a.maxWidth&&{maxWidth:"calc(100% - 64px)"},a.maxWidth==="xs"&&{maxWidth:t.breakpoints.unit==="px"?Math.max(t.breakpoints.values.xs,444):`max(${t.breakpoints.values.xs}${t.breakpoints.unit}, 444px)`,[`&.${oe.paperScrollBody}`]:{[t.breakpoints.down(Math.max(t.breakpoints.values.xs,444)+32*2)]:{maxWidth:"calc(100% - 64px)"}}},a.maxWidth&&a.maxWidth!=="xs"&&{maxWidth:`${t.breakpoints.values[a.maxWidth]}${t.breakpoints.unit}`,[`&.${oe.paperScrollBody}`]:{[t.breakpoints.down(t.breakpoints.values[a.maxWidth]+32*2)]:{maxWidth:"calc(100% - 64px)"}}},a.fullWidth&&{width:"calc(100% - 64px)"},a.fullScreen&&{margin:0,width:"100%",maxWidth:"100%",height:"100%",maxHeight:"none",borderRadius:0,[`&.${oe.paperScrollBody}`]:{margin:0,maxWidth:"100%"}})),Qe=d.forwardRef(function(a,o){const c=Q({props:a,name:"MuiDialog"}),i=Se(),n={enter:i.transitions.duration.enteringScreen,exit:i.transitions.duration.leavingScreen},{"aria-describedby":p,"aria-labelledby":m,BackdropComponent:f,BackdropProps:v,children:C,className:R,disableEscapeKeyDown:j=!1,fullScreen:P=!1,fullWidth:b=!1,maxWidth:q="sm",onBackdropClick:_,onClose:k,open:w,PaperComponent:W=z,PaperProps:$={},scroll:s="paper",TransitionComponent:r=Te,transitionDuration:l=n,TransitionProps:x}=c,S=G(c,He),T=y({},c,{disableEscapeKeyDown:j,fullScreen:P,fullWidth:b,maxWidth:q,scroll:s}),E=Ye(T),O=d.useRef(),Z=A=>{O.current=A.target===A.currentTarget},ee=A=>{O.current&&(O.current=null,_&&_(A),k&&k(A,"backdropClick"))},U=Be(m),L=d.useMemo(()=>({titleId:U}),[U]);return e.jsx(ze,y({className:M(E.root,R),closeAfterTransition:!0,components:{Backdrop:Le},componentsProps:{backdrop:y({transitionDuration:l,as:f},v)},disableEscapeKeyDown:j,onClose:k,open:w,ref:o,onClick:ee,ownerState:T},S,{children:e.jsx(r,y({appear:!0,in:w,timeout:l,role:"presentation"},x,{children:e.jsx(Xe,{className:M(E.container),onMouseDown:Z,ownerState:T,children:e.jsx(Ke,y({as:W,elevation:24,role:"dialog","aria-describedby":p,"aria-labelledby":U},$,{className:M(E.paper,$.className),ownerState:T,children:e.jsx(fe.Provider,{value:L,children:C})}))})}))}))});function Ge(t){return K("MuiDialogActions",t)}X("MuiDialogActions",["root","spacing"]);const Je=["className","disableSpacing"],Ze=t=>{const{classes:a,disableSpacing:o}=t;return J({root:["root",!o&&"spacing"]},Ge,a)},et=N("div",{name:"MuiDialogActions",slot:"Root",overridesResolver:(t,a)=>{const{ownerState:o}=t;return[a.root,!o.disableSpacing&&a.spacing]}})(({ownerState:t})=>y({display:"flex",alignItems:"center",padding:8,justifyContent:"flex-end",flex:"0 0 auto"},!t.disableSpacing&&{"& > :not(style) ~ :not(style)":{marginLeft:8}})),tt=d.forwardRef(function(a,o){const c=Q({props:a,name:"MuiDialogActions"}),{className:i,disableSpacing:n=!1}=c,p=G(c,Je),m=y({},c,{disableSpacing:n}),f=Ze(m);return e.jsx(et,y({className:M(f.root,i),ownerState:m,ref:o},p))});function at(t){return K("MuiDialogContent",t)}X("MuiDialogContent",["root","dividers"]);function ot(t){return K("MuiDialogTitle",t)}const st=X("MuiDialogTitle",["root"]),nt=["className","dividers"],it=t=>{const{classes:a,dividers:o}=t;return J({root:["root",o&&"dividers"]},at,a)},rt=N("div",{name:"MuiDialogContent",slot:"Root",overridesResolver:(t,a)=>{const{ownerState:o}=t;return[a.root,o.dividers&&a.dividers]}})(({theme:t,ownerState:a})=>y({flex:"1 1 auto",WebkitOverflowScrolling:"touch",overflowY:"auto",padding:"20px 24px"},a.dividers?{padding:"16px 24px",borderTop:`1px solid ${(t.vars||t).palette.divider}`,borderBottom:`1px solid ${(t.vars||t).palette.divider}`}:{[`.${st.root} + &`]:{paddingTop:0}})),lt=d.forwardRef(function(a,o){const c=Q({props:a,name:"MuiDialogContent"}),{className:i,dividers:n=!1}=c,p=G(c,nt),m=y({},c,{dividers:n}),f=it(m);return e.jsx(rt,y({className:M(f.root,i),ownerState:m,ref:o},p))}),ct=["className","id"],dt=t=>{const{classes:a}=t;return J({root:["root"]},ot,a)},ut=N(I,{name:"MuiDialogTitle",slot:"Root",overridesResolver:(t,a)=>a.root})({padding:"16px 24px",flex:"0 0 auto"}),pt=d.forwardRef(function(a,o){const c=Q({props:a,name:"MuiDialogTitle"}),{className:i,id:n}=c,p=G(c,ct),m=c,f=dt(m),{titleId:v=n}=d.useContext(fe);return e.jsx(ut,y({component:"h2",className:M(f.root,i),ownerState:m,ref:o,variant:"h6",id:n??v},p))});function be({open:t,onClose:a,product:o,onSelect:c}){var W,$;const[i,n]=d.useState(null),[p,m]=d.useState({}),[f,v]=d.useState("..."),[C,R]=d.useState([]),j=s=>{R(r=>r.filter(l=>l.id!==s))},P=(W=o==null?void 0:o.attributes)==null?void 0:W.every(s=>p[s.attribute]),b=d.useCallback(()=>{if(!P)return;console.log("Fetching Product Variant"),v("Searching...");const s=Object.values(p).join(",");let r=`${ie.baseURL}/api-proxy/proxy?method=get&resource=products&template_id=${o.id}`;s&&(r+=`&attributes=${s}`),console.log(r),re.get(r,{headers:{Authorization:`Bearer ${le.get("jwt")}`}}).then(l=>{console.log(l.data.data),l.data.data&&Object.keys(l.data.data).length>0?s?n(l.data.data):Array.isArray(l.data.data)&&l.data.data.length>0&&n(l.data.data[0]):(n(null),v("Product not found..."))}).catch(l=>{console.error("Error fetching products:",l)})},[P,o.id,p]);d.useEffect(()=>{P&&b()},[P,b]),d.useEffect(()=>{if(i){const s=i.product_template_attribute_value_ids.map(T=>T.name).join(","),{default_code:r,name:l,qty_available:x}=i,S=`${r?`[${r}] `:""}${l}${s?` (${s})`:""}: ${x} available`;v(S)}else v("Product not found...")},[i]);const q=(s,r)=>{m({...p,[s]:r})},_=()=>{if(!Array.isArray(C)||C.length===0){alert("You must select at least one product variant before adding to order.");return}const s=C.map(r=>({...r,attributes:r.product_template_attribute_value_ids,product_template_attribute_value_ids:void 0}));console.log("Final cleaned products to add:",s),c(s)},k=(s,r)=>{const l=parseInt(r,10);R(x=>x.map(S=>S.id===s?{...S,qty_needed:Number.isNaN(l)?"":l}:S))},w=()=>{if(!i){alert("You must have a variant selected! Please select one value for each variant.");return}const s={...i,qty_needed:1};R(r=>r.find(x=>x.id===s.id)?r.map(x=>x.id===s.id?{...x,qty_needed:x.qty_needed+1}:x):[...r,s])};return e.jsxs(Qe,{open:t,onClose:a,maxWidth:"lg",fullWidth:!0,children:[(o==null?void 0:o.name)&&e.jsx(pt,{id:"product-variant-title",variant:"h6",sx:{mb:2},children:o.name}),e.jsxs(lt,{dividers:!0,sx:{maxHeight:"70vh",overflowY:"auto"},children:[($=o==null?void 0:o.attributes)==null?void 0:$.map(s=>e.jsxs(ce,{spacing:1,sx:{mb:2},children:[e.jsx(I,{variant:"subtitle1",children:s.attribute}),e.jsx(Y,{sx:{display:"flex",flexWrap:"wrap",gap:1,maxHeight:150,overflowY:"auto",border:"1px solid #ccc",padding:1,borderRadius:1},children:s.values.map((r,l)=>e.jsx(ne,{label:r[1],clickable:!0,color:p[s.attribute]===r[1]?"primary":"default",onClick:()=>q(s.attribute,r[1]),sx:{borderRadius:"5px",fontWeight:p[s.attribute]===r[1]?"bold":"normal"}},l))})]},s.id)),f&&e.jsxs(Y,{sx:{mt:2,p:2,border:"1px solid #ccc",borderRadius:1,backgroundColor:"#f5f5f5",display:"flex",alignItems:"center",justifyContent:"space-between"},children:[e.jsx(I,{variant:"subtitle1",children:f}),e.jsx(ae,{variant:"contained",color:"primary",onClick:w,disabled:!P,children:"Add"})]}),C.length>0&&e.jsx(Y,{sx:{mt:3},children:e.jsx(ue,{component:z,children:e.jsxs(pe,{children:[e.jsx(he,{children:e.jsxs(F,{children:[e.jsx(g,{children:"Product"}),e.jsx(g,{children:"Attributes"}),e.jsx(g,{children:"Qty Available"}),e.jsx(g,{children:"Qty Needed"}),e.jsx(g,{})," "]})}),e.jsx(xe,{children:C.map(s=>{var r;return e.jsxs(F,{children:[e.jsxs(g,{children:[s.default_code?`[${s.default_code}] `:"",s.name]}),e.jsx(g,{children:(r=s.product_template_attribute_value_ids)==null?void 0:r.map(l=>e.jsx(ne,{label:l.name,size:"small"},l.id))}),e.jsx(g,{children:s.qty_available}),e.jsx(g,{children:e.jsx(Fe,{type:"number",size:"small",value:s.qty_needed,onChange:l=>k(s.id,l.target.value),onBlur:l=>{const x=parseInt(l.target.value,10);(!x||x<1)&&k(s.id,1)},inputProps:{min:1}})}),e.jsx(g,{children:e.jsx(de,{onClick:()=>j(s.id),children:e.jsx(Re,{icon:"eva:trash-2-outline"})})})]},s.id)})})]})})})]}),e.jsxs(tt,{children:[e.jsx(ae,{onClick:a,children:"Cancel"}),e.jsx(ae,{onClick:_,disabled:!P,children:"Add to Order"})]})]})}be.propTypes={open:u.bool.isRequired,onClose:u.func.isRequired,product:u.object,onSelect:u.func};function ye({id:t,name:a,category:o,type:c,list_price:i,attributes:n,onSelect:p}){const m=f=>`$${f.toFixed(2)}`;return e.jsxs(F,{hover:!0,tabIndex:-1,onClick:()=>p({id:t,name:a,category:o,type:c,list_price:i,attributes:n}),children:[e.jsx(g,{children:a}),e.jsx(g,{children:o}),e.jsx(g,{children:c}),e.jsx(g,{children:m(i)})]})}ye.propTypes={id:u.any,name:u.any,category:u.any,type:u.any,list_price:u.any,attributes:u.arrayOf(u.string),onSelect:u.func};function je({order:t,orderBy:a,headLabel:o,onRequestSort:c}){const i=n=>p=>{c(p,n)};return e.jsx(he,{children:e.jsx(F,{children:o.map(n=>e.jsx(g,{align:n.align||"left",sortDirection:a===n.id?t:!1,sx:{width:n.width,minWidth:n.minWidth},children:e.jsxs(Ne,{hideSortIcon:!0,active:a===n.id,direction:a===n.id?t:"desc",onClick:i(n.id),children:[n.label,a===n.id?e.jsx(Y,{sx:{...Oe},children:t==="desc"?"sorted descending":"sorted ascending"}):null]})},n.id))})})}je.propTypes={order:u.oneOf(["asc","desc"]),orderBy:u.string,headLabel:u.array,onRequestSort:u.func};function ve({filterName:t,onFilterName:a,onClickSearch:o,onHitEnter:c}){return e.jsx(we,{sx:{height:96,display:"flex",justifyContent:"space-between",p:i=>i.spacing(0,1,0,3)},children:e.jsx(Ie,{value:t,onChange:a,onKeyDown:c,placeholder:"Search product...",endAdornment:e.jsx(We,{position:"end",children:e.jsx(de,{onClick:o,edge:"end",children:e.jsx($e,{icon:_e,sx:{color:"text.disabled",width:20,height:20}})})})})})}ve.propTypes={filterName:u.string,onFilterName:u.func,onClickSearch:u.func,onHitEnter:u.func};function ht({showTitle:t,onSelect:a}){const[o,c]=d.useState([]),[i,n]=d.useState(0),[p,m]=d.useState(0),[f,v]=d.useState("asc"),[C,R]=d.useState("name"),[j,P]=d.useState(""),[b,q]=d.useState(25),[_,k]=d.useState(0),[w,W]=d.useState(!1),[$,s]=d.useState(null),r=d.useRef(o),l=d.useRef(b),x=d.useRef(i),S=d.useRef(j);d.useEffect(()=>{r.current=o,l.current=b,x.current=i,S.current=j,T(x.current,l.current,r.current,S.current)},[]);const T=(h,D,V,se)=>{console.log("Fetching Products");const Pe=h+1;let te=`${ie.baseURL}/api-proxy/proxy?method=get&resource=product-templates&page=${Pe}&page_size=${D}`;se&&(te+=`&name=${se}`),console.log(te),re.get(te,{headers:{Authorization:`Bearer ${le.get("jwt")}`}}).then(H=>{console.log(H.data.data),c([...V,...H.data.data]),k(H.data.count)}).catch(H=>{console.error("Error fetching products:",H)})},E=(h,D)=>{D!==""&&(v(C===D&&f==="asc"?"desc":"asc"),R(D))},O=(h,D)=>{n(D);const V=b*D;V>p&&(m(V),T(D,b,o,j))},Z=h=>{n(0),q(parseInt(h.target.value,10))},ee=h=>{P(h.target.value)},U=h=>{h.key==="Enter"&&L()},L=h=>{n(0),T(i,b,[],j)},A=h=>{s(h),W(!0)},Ce=!o.length&&!!j;return e.jsxs(qe,{children:[t&&e.jsx(ce,{direction:"row",alignItems:"center",justifyContent:"space-between",mb:5,children:e.jsx(I,{variant:"h4",children:"Products"})}),e.jsxs(Ee,{children:[e.jsx(ve,{filterName:j,onFilterName:ee,onClickSearch:L,onHitEnter:U}),e.jsx(Ae,{children:e.jsx(ue,{sx:{overflow:"unset"},children:e.jsxs(pe,{sx:{minWidth:800},children:[e.jsx(je,{order:f,orderBy:C,rowCount:o.length,onRequestSort:E,headLabel:[{id:"name",label:"Name"},{id:"category",label:"Category"},{id:"type",label:"Type"},{id:"lst_price",label:"Sale Price"}]}),e.jsxs(xe,{children:[o.slice(i*b,i*b+b).map(h=>e.jsx(ye,{id:h.id,name:h.name,category:h.categ_id.name,type:h.type,list_price:h.list_price,attributes:h.attribute_line_ids,onSelect:A},h.id)),e.jsx(me,{height:77,emptyRows:Ue(i,b,o.length)}),Ce&&e.jsx(ge,{query:j})]})]})})}),e.jsx(Me,{page:i,component:"div",count:_,rowsPerPage:b,onPageChange:O,rowsPerPageOptions:[25],onRowsPerPageChange:Z})]}),w&&e.jsx(be,{open:w,onClose:()=>W(!1),product:$,onSelect:a})]})}ht.propTypes={showTitle:u.bool,onSelect:u.func};export{Qe as D,ht as P,pt as a,lt as b,tt as c};
