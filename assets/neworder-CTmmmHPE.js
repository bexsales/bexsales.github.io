import{r as i,j as e,x as _,P as W,w as re,S as P,y as f,T as c,G as oe,z as se,C as T,F as w,E as O,W as ne}from"./index-CBv1zAM1.js";import{P as le,C as ae}from"./product-view-BmmhcACQ.js";import{D as F,a as L,b as k,c as R,G as g}from"./Grid-BhvZbmY7.js";import{F as A,T as b,L as ie}from"./LoadingButton-CinEjmNW.js";import{C as de}from"./customer-view-Bi1eag1K.js";import{d as ce,e as ue,b as he,T as q,a,f as xe}from"./search-fill-gI9diOAi.js";import{C as pe}from"./Container-DnFR7a07.js";import{C as je}from"./Card-DUtNAfYw.js";import{u as me}from"./use-auth-DjvPkv_v.js";import"./Select-KMQscyCo.js";import"./isMuiElement-Dy-u8A1_.js";function B({onSelect:p}){const[j,h]=i.useState(!1),r=()=>{h(!0)},u=()=>{h(!1)},s=x=>{p(x),u()};return e.jsxs("div",{children:[e.jsx(_,{variant:"outlined",onClick:r,children:"Add Product"}),e.jsxs(F,{open:j,onClose:u,maxWidth:"xl",fullWidth:!0,children:[e.jsx(L,{children:"Products"}),e.jsx(k,{children:e.jsx(A,{sx:{width:"100%"},children:e.jsx(le,{onSelect:s,style:{width:"100%"}})})}),e.jsx(R,{children:e.jsx(_,{onClick:u,color:"primary",children:"Close"})})]})]})}B.propTypes={onSelect:W.func};function z({onSelect:p}){const[j,h]=i.useState(!1),r=()=>{h(!0)},u=()=>{h(!1)},s=x=>{p(x),u()};return e.jsxs("div",{children:[e.jsx(_,{variant:"outlined",onClick:r,children:"Set"}),e.jsxs(F,{open:j,onClose:u,maxWidth:"xl",fullWidth:!0,children:[e.jsx(L,{children:"Customers"}),e.jsx(k,{sx:{padding:0},children:e.jsx(A,{sx:{width:"100%"},children:e.jsx(de,{onSelect:s,style:{width:"100%"}})})}),e.jsx(R,{children:e.jsx(_,{onClick:u,color:"primary",children:"Close"})})]})]})}z.propTypes={onSelect:W.func};function ye(){const p=re(),[j,h]=i.useState(!1),[r,u]=i.useState({id:0,name:"",street:"",city:"",state:"",country:"",zip:"",phone:"",mobile:"",email:""}),[s,x]=i.useState([]),[C,D]=i.useState({}),[E,N]=i.useState(0),[U,$]=i.useState(0),[I,M]=i.useState(0),[v,Q]=i.useState(""),[S,G]=i.useState(""),V=(t,l)=>{console.log("Fetching order totals");const n=`${O.baseURL}/api-proxy/proxy?method=post&resource=ordertotals`;console.log(n);const o=s.map(d=>({product_id:d.id,product_uom_qty:d.product_uom_qty})),m={partner_id:r.id,order_line:o};console.log("Request body",m),T.post(n,m,{headers:{Authorization:`Bearer ${w.get("jwt")}`}}).then(d=>{console.log(d.data),D(d.data.result.product_prices),N(d.data.result.subtotal),$(d.data.result.total)}).catch(d=>{console.error("Error fetching order totals:",d)})};i.useEffect(()=>{V();const t=s.reduce((l,n)=>l+n.product_uom_qty,0);M(t)},[r,s]);const H=(t,l,n)=>{if(t<0||t>=s.length)return;const o=s.filter((m,d)=>d!==t);x(o)},X=(t,l)=>{const n=s.map((o,m)=>m===t?{...o,product_uom_qty:l!==0?Number(l):0}:o);x(n)},y=t=>t?`$${t.toFixed(2)}`:"",J=t=>{console.log("Setting order partner"),console.log(t),u({id:t.id,name:t.name,street:t.street,city:t.city,state:t.state,country:t.country,zip:t.zip,phone:t.phone,mobile:t.mobile,email:t.email})},K=t=>{console.log("Adding order line"),console.log(t),x([...s,{id:t.id,name:t.name,default_code:t.default_code,category:t.category,type:t.type,lst_price:t.lst_price,invoice_policy:t.invoice_policy,description_sale:t.description_sale,attributes:t.attributes,sale_ok:t.sale_ok,purchase_ok:t.purchase_ok,sales_count:t.sales_count,product_uom_qty:1}])},Y=t=>{Q(t.target.value)},Z=t=>{G(t.target.value)},ee=()=>{h(!0),console.log("Creating an order");const t=`${O.baseURL}/api-proxy/proxy?method=post&resource=orders`;console.log(t),console.log(s);const l=s.map(o=>({product_id:o.id,product_uom_qty:o.product_uom_qty}));console.log(l);const n={order:{partner_id:r.id,order_line:l,x_studio_notes:v,client_order_ref:S}};console.log("Request body",n),T.post(t,n,{headers:{Authorization:`Bearer ${w.get("jwt")}`}}).then(o=>{console.log(o.data),h(!1),p.push(`/orders/${o.data.result.sale_order_id}`)}).catch(o=>{console.error("Error fetching customers:",o)})},te=e.jsxs(e.Fragment,{children:[e.jsx(P,{spacing:3,direction:"row",alignItems:"center",children:e.jsx(b,{fullWidth:!0,name:"partner_id",label:"Customer",value:r.name,InputProps:{readOnly:!0,endAdornment:e.jsx(f,{children:e.jsx(z,{onSelect:J})})}})}),r.name&&e.jsxs(e.Fragment,{children:[e.jsx("div",{style:{margin:"16px 0"}}),e.jsx(c,{variant:"body1",fontWeight:"bold",children:"Address:"}),e.jsx(c,{variant:"body1",children:r.street}),e.jsxs(c,{variant:"body1",children:[r.city," ",r.state]}),e.jsxs(c,{variant:"body1",children:[r.country," ",r.zip]}),e.jsxs(c,{variant:"body1",children:[e.jsx("b",{children:"Phone:"})," ",r.phone]}),e.jsxs(c,{variant:"body1",children:[e.jsx("b",{children:"Mobile:"})," ",r.mobile]}),e.jsxs(c,{variant:"body1",children:[e.jsx("b",{children:"Email:"})," ",r.email]})]}),e.jsx("div",{style:{margin:"16px 0"}}),e.jsx(f,{children:e.jsx(B,{onSelect:K})}),e.jsx("div",{style:{margin:"16px 0"}}),e.jsx(ce,{component:oe,children:e.jsxs(ue,{children:[e.jsx(he,{children:e.jsxs(q,{children:[e.jsx(a,{children:"Product"}),e.jsx(a,{children:"Attributes"}),e.jsx(a,{children:"Unit Price"}),e.jsx(a,{children:"Qty"}),e.jsx(a,{children:"Subtotal"}),e.jsx(a,{})]})}),e.jsx(xe,{children:s.map((t,l)=>e.jsxs(q,{children:[e.jsxs(a,{children:["[",t.default_code,"] ",t.name]}),e.jsx(a,{children:t.attributes.map((n,o)=>e.jsx(ae,{label:n,variant:"outlined"},o))}),e.jsx(a,{children:y(C[t.id])}),e.jsx(a,{children:e.jsx(b,{type:"number",style:{minWidth:"100px"},value:t.product_uom_qty!==0?t.product_uom_qty:"",onChange:n=>X(l,n.target.value)})}),e.jsx(a,{children:y(C[t.id]*t.product_uom_qty)}),e.jsx(a,{align:"right",children:e.jsx(f,{onClick:()=>H(l),children:e.jsx(se,{icon:"eva:trash-2-outline"})})})]},l))})]})}),e.jsx("div",{style:{margin:"16px 0"}}),e.jsxs(c,{variant:"body1",fontWeight:"bold",children:["Total Product Qty: ",I]}),e.jsxs(c,{variant:"body1",fontWeight:"bold",children:["Subtotal: ",y(E)]}),e.jsxs(c,{variant:"body1",fontWeight:"bold",children:["Total: ",y(U)]}),e.jsx("div",{style:{margin:"16px 0"}}),e.jsx(g,{container:!0,spacing:2,children:e.jsx(g,{item:!0,xs:12,md:6,lg:6,children:e.jsx(b,{label:"Notes",value:v,multiline:!0,fullWidth:!0,rows:4,onChange:Y})})}),e.jsx("div",{style:{margin:"16px 0"}}),e.jsx(g,{container:!0,spacing:2,children:e.jsx(g,{item:!0,xs:12,md:6,lg:6,children:e.jsx(b,{label:"PO Number",value:S,fullWidth:!0,onChange:Z})})}),e.jsx("div",{style:{margin:"16px 0"}}),e.jsx(ie,{fullWidth:!0,size:"large",type:"submit",variant:"contained",color:"inherit",onClick:ee,loading:j,children:"Create"})]});return e.jsxs(pe,{children:[e.jsx(P,{direction:"row",alignItems:"center",justifyContent:"space-between",mb:5,children:e.jsx(c,{variant:"h4",children:"New Order"})}),te,e.jsx(je,{})]})}function qe(){return me(),e.jsxs(e.Fragment,{children:[e.jsx(ne,{children:e.jsx("title",{children:" New Order | BEX Sales "})}),e.jsx(ye,{})]})}export{qe as default};
