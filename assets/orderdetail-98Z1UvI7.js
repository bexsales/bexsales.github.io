import{g as je,k as ge,h as ye,T as x,M as fe,r as n,i as be,a as Ce,j as e,_ as V,b as _e,f as ve,x as C,P,S as L,y as O,z as H,C as w,F as D,G as Se,E as q,N as Te,W as Oe}from"./index-BcWQSKyp.js";import{P as Pe,C as we}from"./product-view-XjCWSbG6.js";import{D as F,a as W,b as $,c as R,G as S}from"./Grid-DFrYQOKE.js";import{F as X,T,L as De}from"./LoadingButton-DvAp7pFQ.js";import{C as qe}from"./customer-view-B8JH5BVW.js";import{d as Le,e as Fe,b as We,T as G,a as m,f as $e}from"./search-fill-DZLUiPN_.js";import{C as Re}from"./Container-DtTzg37J.js";import{C as Ue}from"./Card-DQ9jjwxh.js";import{u as Ae}from"./use-auth-BXa-8eZP.js";import"./Select-C0mmkfLY.js";import"./isMuiElement-D0tAOn47.js";function ke(s){return je("MuiDialogContentText",s)}ge("MuiDialogContentText",["root"]);const Me=["children","className"],Ne=s=>{const{classes:l}=s,c=ve({root:["root"]},ke,l);return V({},l,c)},Be=ye(x,{shouldForwardProp:s=>fe(s)||s==="classes",name:"MuiDialogContentText",slot:"Root",overridesResolver:(s,l)=>l.root})({}),Ee=n.forwardRef(function(l,i){const c=be({props:l,name:"MuiDialogContentText"}),{className:d}=c,y=Ce(c,Me),f=Ne(y);return e.jsx(Be,V({component:"p",variant:"body1",color:"text.secondary",ref:i,ownerState:y,className:_e(f.root,d)},c,{classes:f}))}),ze=Ee;function J({onSelect:s}){const[l,i]=n.useState(!1),c=()=>{i(!0)},d=()=>{i(!1)},y=f=>{s(f),d()};return e.jsxs("div",{children:[e.jsx(C,{variant:"outlined",onClick:c,children:"Add Product"}),e.jsxs(F,{open:l,onClose:d,maxWidth:"xl",fullWidth:!0,children:[e.jsx(W,{children:"Products"}),e.jsx($,{children:e.jsx(X,{sx:{width:"100%"},children:e.jsx(Pe,{onSelect:y,style:{width:"100%"}})})}),e.jsx(R,{children:e.jsx(C,{onClick:d,color:"primary",children:"Close"})})]})]})}J.propTypes={onSelect:P.func};function K({onSelect:s}){const[l,i]=n.useState(!1),c=()=>{i(!0)},d=()=>{i(!1)},y=f=>{s(f),d()};return e.jsxs("div",{children:[e.jsx(C,{variant:"outlined",onClick:c,children:"Set"}),e.jsxs(F,{open:l,onClose:d,maxWidth:"xl",fullWidth:!0,children:[e.jsx(W,{children:"Customers"}),e.jsx($,{sx:{padding:0},children:e.jsx(X,{sx:{width:"100%"},children:e.jsx(qe,{onSelect:y,style:{width:"100%"}})})}),e.jsx(R,{children:e.jsx(C,{onClick:d,color:"primary",children:"Close"})})]})]})}K.propTypes={onSelect:P.func};function Y({handleCancelOrder:s}){const[l,i]=n.useState(!1),c=()=>{i(!0)},d=()=>{i(!1)};return e.jsxs(L,{direction:"row",alignItems:"center",children:[e.jsx(x,{variant:"body1",sx:{color:"red"},children:"Cancel"}),e.jsxs(O,{onClick:c,sx:{color:"red"},children:[e.jsx(H,{icon:"eva:close-outline"})," "]}),e.jsxs(F,{open:l,onClose:d,"aria-labelledby":"alert-dialog-title","aria-describedby":"alert-dialog-description",children:[e.jsx(W,{id:"alert-dialog-title",children:"Confirm Cancellation"}),e.jsx($,{children:e.jsx(ze,{id:"alert-dialog-description",children:"Are you sure you want to cancel this order?"})}),e.jsxs(R,{children:[e.jsx(C,{onClick:d,color:"primary",children:"Cancel"}),e.jsx(C,{onClick:s,color:"primary",autoFocus:!0,children:"Confirm"})]})]})]})}Y.propTypes={handleCancelOrder:P.func};function Z({orderId:s}){const[l,i]=n.useState(!1),[c,d]=n.useState(""),[y,f]=n.useState(""),[u,U]=n.useState({id:0,name:"",street:"",city:"",state:"",country:"",zip:"",phone:"",mobile:"",email:""}),[j,_]=n.useState([]),[A,ee]=n.useState([]),[k,te]=n.useState({}),[oe,M]=n.useState(0),[re,N]=n.useState(0),[se,ne]=n.useState(0),[B,E]=n.useState(""),[z,I]=n.useState("");n.useEffect(()=>{he()},[]);const ae=()=>{Q(!0)},le=(t,o)=>{console.log("Fetching order totals");const a=`${q.baseURL}/api-proxy/proxy?method=post&resource=ordertotals`;console.log(a);const r=j.map(h=>({product_id:h[2].id,product_uom_qty:h[2].product_uom_qty})),g={partner_id:u.id,order_line:r};console.log("Request body",g),w.post(a,g,{headers:{Authorization:`Bearer ${D.get("jwt")}`}}).then(h=>{console.log(h.data),te(h.data.result.product_prices),M(h.data.result.subtotal),N(h.data.result.total)}).catch(h=>{console.error("Error fetching order totals:",h)})};n.useEffect(()=>{le();const t=j.reduce((o,a)=>o+a[2].product_uom_qty,0);ne(t)},[u,j]);const ie=t=>{E(t.target.value)},de=t=>{I(t.target.value)},Q=t=>{i(!0),console.log("Saving Order");let o="post";t===!0&&(o="cancel");const a=`${q.baseURL}/api-proxy/proxy?method=${o}&resource=orders`;console.log(a),console.log(j);const r=j.map(p=>[p[0],p[1],{product_id:p[2].id,product_uom_qty:p[2].product_uom_qty}]),g=A.map(p=>[2,p[1],{}]),h=r.concat(g),b={order:{id:parseInt(s,10),partner_id:u.id,order_line:h,x_studio_notes:B,client_order_ref:z}};console.log("Request body",b),w.post(a,b,{headers:{Authorization:`Bearer ${D.get("jwt")}`}}).then(p=>{console.log(p.data),i(!1),p.data.result.success===!1?alert(p.data.result.message):window.location.reload()}).catch(p=>{console.error("Error saving order:",p)})},ce=(t,o,a)=>{if(t<0||t>=j.length)return;const r=j.filter((h,b)=>b===t);r[0][0]!==0&&(console.log("Adding line to delete queue",r),ee(A.concat(r)));const g=j.filter((h,b)=>b!==t);_(g)},ue=(t,o)=>{const a=j.map((r,g)=>g===t?(console.log("handle qty change",r),[r[0],r[1],{...r[2],product_uom_qty:o!==0?Number(o):0}]):r);_(a)},v=t=>t?`$${t.toFixed(2)}`:"",he=()=>{console.log("Fetching Order Details");const t=`${q.baseURL}/api-proxy/proxy?method=get&resource=orders&order_id=${s}`;console.log(t),w.get(t,{headers:{Authorization:`Bearer ${D.get("jwt")}`}}).then(o=>{console.log(o.data.data),d(o.data.data.name),U(o.data.data.customer_id),E(o.data.data.x_studio_notes),I(o.data.data.client_order_ref?o.data.data.client_order_ref:"");const a=o.data.data.order_line.map(r=>[1,r.id,{line_id:r.id,id:r.product_id.id,name:r.name,product_uom_qty:r.product_uom_qty,attributes:r.product_id.attributes.map(g=>`${g.attribute}:${g.name}`)}]);console.log(a),_(a),M(o.data.data.amount_untaxed),N(o.data.data.amount_total),f(o.data.data.state)}).catch(o=>{console.error("Error fetching order details:",o)})},xe=t=>{console.log("Setting order partner"),console.log(t),U({id:t.id,name:t.name,street:t.street,city:t.city,state:t.state,country:t.country,zip:t.zip,phone:t.phone,mobile:t.mobile,email:t.email})},pe=t=>{console.log("Adding order line"),console.log(t),_([...j,[0,0,{id:t.id,name:`[${t.default_code}] ${t.name}`,product_uom_qty:1,attributes:t.attributes}]])},me=e.jsxs(e.Fragment,{children:[e.jsx(L,{spacing:3,direction:"row",alignItems:"center",children:e.jsx(T,{fullWidth:!0,name:"partner_id",label:"Customer",value:u.name,InputProps:{readOnly:!0,endAdornment:e.jsx(O,{children:e.jsx(K,{onSelect:xe})})}})}),u.name&&e.jsxs(e.Fragment,{children:[e.jsx("div",{style:{margin:"16px 0"}}),e.jsx(x,{variant:"body1",fontWeight:"bold",children:"Address:"}),e.jsx(x,{variant:"body1",children:u.street}),e.jsxs(x,{variant:"body1",children:[u.city," ",u.state]}),e.jsxs(x,{variant:"body1",children:[u.country," ",u.zip]}),e.jsxs(x,{variant:"body1",children:[e.jsx("b",{children:"Phone:"})," ",u.phone]}),e.jsxs(x,{variant:"body1",children:[e.jsx("b",{children:"Mobile:"})," ",u.mobile]}),e.jsxs(x,{variant:"body1",children:[e.jsx("b",{children:"Email:"})," ",u.email]})]}),e.jsx(O,{children:e.jsx(J,{onSelect:pe})}),e.jsx("div",{style:{margin:"16px 0"}}),e.jsx(Le,{component:Se,children:e.jsxs(Fe,{children:[e.jsx(We,{children:e.jsxs(G,{children:[e.jsx(m,{children:"Product"}),e.jsx(m,{children:"Attributes"}),e.jsx(m,{children:"Unit Price"}),e.jsx(m,{children:"Qty"}),e.jsx(m,{children:"Subtotal"}),e.jsx(m,{})]})}),e.jsx($e,{children:j.map((t,o)=>e.jsxs(G,{children:[e.jsx(m,{children:t[2].name}),e.jsx(m,{children:t[2].attributes.map((a,r)=>e.jsx(we,{label:a,variant:"outlined"},r))}),e.jsx(m,{children:v(k[t[2].id])}),e.jsx(m,{children:e.jsx(T,{type:"number",style:{minWidth:"100px"},value:t[2].product_uom_qty!==0?t[2].product_uom_qty:"",onChange:a=>ue(o,a.target.value)})}),e.jsx(m,{children:v(k[t[2].id]*t[2].product_uom_qty)}),e.jsx(m,{align:"right",children:e.jsx(O,{onClick:()=>ce(o),children:e.jsx(H,{icon:"eva:trash-2-outline"})})})]},o))})]})}),e.jsx("div",{style:{margin:"16px 0"}}),e.jsxs(x,{variant:"body1",fontWeight:"bold",children:["Total Product Qty: ",se]}),e.jsxs(x,{variant:"body1",fontWeight:"bold",children:["Subtotal: ",v(oe)]}),e.jsxs(x,{variant:"body1",fontWeight:"bold",children:["Total: ",v(re)]}),e.jsx("div",{style:{margin:"16px 0"}}),e.jsx(S,{container:!0,spacing:2,children:e.jsx(S,{item:!0,xs:12,md:6,lg:6,children:e.jsx(T,{label:"Notes",value:B,multiline:!0,fullWidth:!0,rows:4,onChange:ie})})}),e.jsx("div",{style:{margin:"16px 0"}}),e.jsx(S,{container:!0,spacing:2,children:e.jsx(S,{item:!0,xs:12,md:6,lg:6,children:e.jsx(T,{label:"PO Number",value:z,fullWidth:!0,onChange:de})})}),e.jsx("div",{style:{margin:"16px 0"}}),e.jsx(De,{fullWidth:!0,size:"large",type:"submit",variant:"contained",color:"inherit",onClick:Q,loading:l,children:"Save"})]});return e.jsxs(Re,{children:[e.jsxs(L,{direction:"row",alignItems:"center",justifyContent:"space-between",mb:5,children:[e.jsxs(x,{variant:"h4",children:["Order ",c," [",y,"]"]}),y==="draft"&&e.jsx(Y,{handleCancelOrder:ae})]}),me,e.jsx(Ue,{})]})}Z.propTypes={orderId:P.any};function tt(){Ae();const{orderId:s}=Te();return e.jsxs(e.Fragment,{children:[e.jsx(Oe,{children:e.jsx("title",{children:" Order Detail | BEX Sales "})}),e.jsx(Z,{orderId:s})]})}export{tt as default};
