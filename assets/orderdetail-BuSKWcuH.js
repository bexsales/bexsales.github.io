import{g as Oe,k as Pe,h as Te,T as a,M as qe,r as s,i as we,a as De,j as e,_ as Y,b as Le,f as We,x as C,P as _,S as v,C as S,D as R,y as M,z as $,G as ke,A as z,N as Ae,W as Fe}from"./index-CBR0lYpA.js";import{P as Me,C as $e}from"./product-view-7rd5JYPn.js";import{D as T,a as q,b as w,c as D,G as k}from"./Grid-Bxkx1I6m.js";import{F as U,T as P,L as ze}from"./LoadingButton-z_nVkxyY.js";import{C as Z}from"./customer-view-DFyYgmdM.js";import{d as Re,e as Ue,b as Ee,T as K,a as x,f as Ie}from"./search-fill-DOoDgs8Z.js";import{C as Ne}from"./Container-C7fgGlSN.js";import{C as Be}from"./Card-Bd4s6eWi.js";import{u as Qe}from"./use-auth-D-_uWrfZ.js";import"./Select-Ckj7kxKA.js";import"./isMuiElement-BpISYYX1.js";function Ge(n){return Oe("MuiDialogContentText",n)}Pe("MuiDialogContentText",["root"]);const Ve=["children","className"],He=n=>{const{classes:l}=n,u=We({root:["root"]},Ge,l);return Y({},l,u)},Xe=Te(a,{shouldForwardProp:n=>qe(n)||n==="classes",name:"MuiDialogContentText",slot:"Root",overridesResolver:(n,l)=>l.root})({}),Je=s.forwardRef(function(l,i){const u=we({props:l,name:"MuiDialogContentText"}),{className:d}=u,j=De(u,Ve),b=He(j);return e.jsx(Xe,Y({component:"p",variant:"body1",color:"text.secondary",ref:i,ownerState:j,className:Le(b.root,d)},u,{classes:b}))}),ee=Je;function te({onSelect:n}){const[l,i]=s.useState(!1),u=()=>{i(!0)},d=()=>{i(!1)},j=b=>{n(b),d()};return e.jsxs("div",{children:[e.jsx(C,{variant:"outlined",onClick:u,children:"Add Product"}),e.jsxs(T,{open:l,onClose:d,maxWidth:"xl",fullWidth:!0,children:[e.jsx(q,{children:"Products"}),e.jsx(w,{children:e.jsx(U,{sx:{width:"100%"},children:e.jsx(Me,{onSelect:j,style:{width:"100%"}})})}),e.jsx(D,{children:e.jsx(C,{onClick:d,color:"primary",children:"Close"})})]})]})}te.propTypes={onSelect:_.func};function re({handleSendOrder:n}){const[l,i]=s.useState(!1),u=()=>{i(!0)},d=()=>{i(!1)};return e.jsxs(v,{direction:"row",alignItems:"center",children:[e.jsx(a,{variant:"body1",sx:{color:"blue"},children:"Email"}),e.jsxs(S,{onClick:u,sx:{color:"blue"},children:[e.jsx(R,{icon:"mdi:send"})," "]}),e.jsxs(T,{open:l,onClose:d,"aria-labelledby":"alert-dialog-title","aria-describedby":"alert-dialog-description",children:[e.jsx(q,{id:"alert-dialog-title",children:"Confirm Send"}),e.jsx(w,{children:e.jsx(ee,{id:"alert-dialog-description",children:"Are you sure you want to send this order?"})}),e.jsxs(D,{children:[e.jsx(C,{onClick:d,color:"primary",children:"Cancel"}),e.jsx(C,{onClick:n,color:"primary",autoFocus:!0,children:"Confirm"})]})]})]})}re.propTypes={handleSendOrder:_.func};function oe({onSelect:n}){const[l,i]=s.useState(!1),u=()=>{i(!0)},d=()=>{i(!1)},j=b=>{n(b),d()};return e.jsxs("div",{children:[e.jsx(C,{variant:"outlined",onClick:u,children:"Set"}),e.jsxs(T,{open:l,onClose:d,maxWidth:"xl",fullWidth:!0,children:[e.jsx(q,{children:"Customers"}),e.jsx(w,{sx:{padding:0},children:e.jsx(U,{sx:{width:"100%"},children:e.jsx(Z,{onSelect:j,style:{width:"100%"}})})}),e.jsx(D,{children:e.jsx(C,{onClick:d,color:"primary",children:"Close"})})]})]})}oe.propTypes={onSelect:_.func};function ne({onSelect:n,filterParentContactOption:l}){const[i,u]=s.useState(!1),d=()=>{u(!0)},j=()=>{u(!1)},b=c=>{n(c),j()};return s.useEffect(()=>{console.log("DeliveryPopupModal Props:"),console.log("filterParentContactOption:",l)},[n,l]),e.jsxs("div",{children:[e.jsx(C,{variant:"outlined",onClick:d,children:"Set"}),e.jsxs(T,{open:i,onClose:j,maxWidth:"xl",fullWidth:!0,children:[e.jsx(q,{children:"Customers"}),e.jsx(w,{sx:{padding:0},children:e.jsx(U,{sx:{width:"100%"},children:e.jsx(Z,{onSelect:b,filterTypeOption:"delivery",filterParentContactOption:l,style:{width:"100%"}})})}),e.jsx(D,{children:e.jsx(C,{onClick:j,color:"primary",children:"Close"})})]})]})}ne.propTypes={onSelect:_.func,filterParentContactOption:_.number};function se({handleCancelOrder:n}){const[l,i]=s.useState(!1),u=()=>{i(!0)},d=()=>{i(!1)};return e.jsxs(v,{direction:"row",alignItems:"center",children:[e.jsx(a,{variant:"body1",sx:{color:"red"},children:"Cancel"}),e.jsxs(S,{onClick:u,sx:{color:"red"},children:[e.jsx(R,{icon:"eva:close-outline"})," "]}),e.jsxs(T,{open:l,onClose:d,"aria-labelledby":"alert-dialog-title","aria-describedby":"alert-dialog-description",children:[e.jsx(q,{id:"alert-dialog-title",children:"Confirm Cancellation"}),e.jsx(w,{children:e.jsx(ee,{id:"alert-dialog-description",children:"Are you sure you want to cancel this order?"})}),e.jsxs(D,{children:[e.jsx(C,{onClick:d,color:"primary",children:"Cancel"}),e.jsx(C,{onClick:n,color:"primary",autoFocus:!0,children:"Confirm"})]})]})]})}se.propTypes={handleCancelOrder:_.func};function ae({orderId:n}){const[l,i]=s.useState(!1),[u,d]=s.useState(""),[j,b]=s.useState(""),[c,E]=s.useState({id:0,name:"",street:"",city:"",state:"",country:"",zip:"",phone:"",mobile:"",email:""}),[f,A]=s.useState({id:0,name:"",street:"",city:"",state:"",country:"",zip:"",phone:"",mobile:"",email:""}),[y,L]=s.useState([]),[I,le]=s.useState([]),[N,ie]=s.useState({}),[de,B]=s.useState(0),[ce,Q]=s.useState(0),[ue,he]=s.useState(0),[G,V]=s.useState(""),[H,X]=s.useState("");s.useEffect(()=>{fe()},[]);const pe=()=>{F(!0,!1)},xe=()=>{F(!1,!0)},je=(t,r)=>{console.log("Fetching order totals");const h=`${z.baseURL}/api-proxy/proxy?method=post&resource=ordertotals`;console.log(h);const o=y.map(p=>({product_id:p[2].id,product_uom_qty:p[2].product_uom_qty})),g={partner_id:c.id,order_line:o};console.log("Request body",g),M.post(h,g,{headers:{Authorization:`Bearer ${$.get("jwt")}`}}).then(p=>{console.log(p.data),ie(p.data.result.product_prices),B(p.data.result.subtotal),Q(p.data.result.total)}).catch(p=>{console.error("Error fetching order totals:",p)})};s.useEffect(()=>{je();const t=y.reduce((r,h)=>r+h[2].product_uom_qty,0);he(t)},[c,y]);const me=t=>{V(t.target.value)},ye=t=>{X(t.target.value)},F=(t,r)=>{i(!0),console.log("Saving Order");let h="post";t===!0&&(h="cancel");const o=`${z.baseURL}/api-proxy/proxy?method=${h}&resource=orders`;console.log(o),console.log(y);const g=y.map(m=>[m[0],m[1],{product_id:m[2].id,product_uom_qty:m[2].product_uom_qty}]),p=I.map(m=>[2,m[1],{}]),O=g.concat(p),J={order:{id:parseInt(n,10),partner_id:c.id,order_line:O,x_studio_notes:G,client_order_ref:H,...r&&{is_send:!0},...f.id&&{partner_shipping_id:f.id}}};console.log("Request body",J),M.post(o,J,{headers:{Authorization:`Bearer ${$.get("jwt")}`}}).then(m=>{console.log(m.data),i(!1),m.data.result.success===!1?alert(m.data.result.message):window.location.reload()}).catch(m=>{console.error("Error saving order:",m)})},ge=(t,r,h)=>{if(t<0||t>=y.length)return;const o=y.filter((p,O)=>O===t);o[0][0]!==0&&(console.log("Adding line to delete queue",o),le(I.concat(o)));const g=y.filter((p,O)=>O!==t);L(g)},be=(t,r)=>{const h=y.map((o,g)=>{if(g===t){console.log("handle qty change",o);const p=["consu","service"];return o[2].qty_available<r&&!p.includes(o[2].type)?(alert("Quantity available is insufficient."),o):[o[0],o[1],{...o[2],product_uom_qty:r!==0?Number(r):0}]}return o});L(h)},W=t=>t?`$${t.toFixed(2)}`:"",fe=()=>{console.log("Fetching Order Details");const t=`${z.baseURL}/api-proxy/proxy?method=get&resource=orders&order_id=${n}`;console.log(t),M.get(t,{headers:{Authorization:`Bearer ${$.get("jwt")}`}}).then(r=>{console.log(r.data.data),d(r.data.data.name),E(r.data.data.customer_id),A(r.data.data.partner_shipping_id),V(r.data.data.x_studio_notes),X(r.data.data.client_order_ref?r.data.data.client_order_ref:"");const h=r.data.data.order_line.map(o=>[1,o.id,{line_id:o.id,id:o.product_id.id,name:o.name,product_uom_qty:o.product_uom_qty,attributes:o.product_id.attributes.map(g=>`${g.attribute}:${g.name}`),qty_available:o.product_id.qty_available,type:o.product_id.type}]);console.log(h),L(h),B(r.data.data.amount_untaxed),Q(r.data.data.amount_total),b(r.data.data.state)}).catch(r=>{console.error("Error fetching order details:",r)})},Ce=t=>{console.log("Setting order partner"),console.log(t),E({id:t.id,name:t.name,street:t.street,city:t.city,state:t.state,country:t.country,zip:t.zip,phone:t.phone,mobile:t.mobile,email:t.email}),A({id:0,name:"",street:"",city:"",state:"",country:"",zip:"",phone:"",mobile:"",email:""})},_e=t=>{console.log("Setting order partner"),console.log(t),A({id:t.id,name:t.name,street:t.street,city:t.city,state:t.state,country:t.country,zip:t.zip,phone:t.phone,mobile:t.mobile,email:t.email})},ve=t=>{console.log("Adding order line"),console.log(t);const r=["consu","service"];t.qty_available<1&&!r.includes(t.type)?alert("Cannot add product lines with 0 qty available"):L([...y,[0,0,{id:t.id,name:`[${t.default_code}] ${t.name}`,product_uom_qty:1,attributes:t.attributes,qty_available:t.qty_available}]])},Se=e.jsxs(e.Fragment,{children:[e.jsx(v,{spacing:3,direction:"row",alignItems:"center",children:e.jsx(P,{fullWidth:!0,name:"partner_id",label:"Customer",value:c.name,InputProps:{readOnly:!0,endAdornment:e.jsx(S,{children:e.jsx(oe,{onSelect:Ce})})}})}),c.name&&e.jsxs(e.Fragment,{children:[e.jsx("div",{style:{margin:"16px 0"}}),e.jsx(a,{variant:"body1",fontWeight:"bold",children:"Address:"}),e.jsx(a,{variant:"body1",children:c.street}),e.jsxs(a,{variant:"body1",children:[c.city," ",c.state]}),e.jsxs(a,{variant:"body1",children:[c.country," ",c.zip]}),e.jsxs(a,{variant:"body1",children:[e.jsx("b",{children:"Phone:"})," ",c.phone]}),e.jsxs(a,{variant:"body1",children:[e.jsx("b",{children:"Mobile:"})," ",c.mobile]}),e.jsxs(a,{variant:"body1",children:[e.jsx("b",{children:"Email:"})," ",c.email]})]}),e.jsx("div",{style:{margin:"16px 0"}}),c.name&&e.jsx(v,{spacing:3,direction:"row",alignItems:"center",children:e.jsx(P,{fullWidth:!0,name:"partner_shipping_id",label:"Delivery Address",value:f.name,InputProps:{readOnly:!0,endAdornment:e.jsx(S,{children:e.jsx(ne,{onSelect:_e,filterParentContactOption:c.id})})}})}),f.name&&e.jsxs(e.Fragment,{children:[e.jsx("div",{style:{margin:"16px 0"}}),e.jsx(a,{variant:"body1",fontWeight:"bold",children:"Address:"}),e.jsx(a,{variant:"body1",children:f.street}),e.jsxs(a,{variant:"body1",children:[f.city," ",c.state]}),e.jsxs(a,{variant:"body1",children:[f.country," ",c.zip]}),e.jsxs(a,{variant:"body1",children:[e.jsx("b",{children:"Phone:"})," ",f.phone]}),e.jsxs(a,{variant:"body1",children:[e.jsx("b",{children:"Mobile:"})," ",f.mobile]}),e.jsxs(a,{variant:"body1",children:[e.jsx("b",{children:"Email:"})," ",f.email]})]}),e.jsx("div",{style:{margin:"16px 0"}}),e.jsx(S,{children:e.jsx(te,{onSelect:ve})}),e.jsx("div",{style:{margin:"16px 0"}}),e.jsx(Re,{component:ke,children:e.jsxs(Ue,{children:[e.jsx(Ee,{children:e.jsxs(K,{children:[e.jsx(x,{children:"Product"}),e.jsx(x,{children:"Attributes"}),e.jsx(x,{children:"Unit Price"}),e.jsx(x,{children:"Qty Available"}),e.jsx(x,{children:"Qty"}),e.jsx(x,{children:"Subtotal"}),e.jsx(x,{})]})}),e.jsx(Ie,{children:y.map((t,r)=>e.jsxs(K,{children:[e.jsx(x,{children:t[2].name}),e.jsx(x,{children:t[2].attributes.map((h,o)=>e.jsx($e,{label:h,variant:"outlined"},o))}),e.jsx(x,{children:W(N[t[2].id])}),e.jsx(x,{children:t[2].qty_available}),e.jsx(x,{children:e.jsx(P,{type:"number",style:{minWidth:"100px"},value:t[2].product_uom_qty!==0?t[2].product_uom_qty:"",onChange:h=>be(r,h.target.value)})}),e.jsx(x,{children:W(N[t[2].id]*t[2].product_uom_qty)}),e.jsx(x,{align:"right",children:e.jsx(S,{onClick:()=>ge(r),children:e.jsx(R,{icon:"eva:trash-2-outline"})})})]},r))})]})}),e.jsx("div",{style:{margin:"16px 0"}}),e.jsxs(a,{variant:"body1",fontWeight:"bold",children:["Total Product Qty: ",ue]}),e.jsxs(a,{variant:"body1",fontWeight:"bold",children:["Subtotal: ",W(de)]}),e.jsxs(a,{variant:"body1",fontWeight:"bold",children:["Total: ",W(ce)]}),e.jsx("div",{style:{margin:"16px 0"}}),e.jsx(k,{container:!0,spacing:2,children:e.jsx(k,{item:!0,xs:12,md:6,lg:6,children:e.jsx(P,{label:"Notes",value:G,multiline:!0,fullWidth:!0,rows:4,onChange:me})})}),e.jsx("div",{style:{margin:"16px 0"}}),e.jsx(k,{container:!0,spacing:2,children:e.jsx(k,{item:!0,xs:12,md:6,lg:6,children:e.jsx(P,{label:"PO Number",value:H,fullWidth:!0,onChange:ye})})}),e.jsx("div",{style:{margin:"16px 0"}}),e.jsx(ze,{fullWidth:!0,size:"large",type:"submit",variant:"contained",color:"inherit",onClick:F,loading:l,children:"Save"})]});return e.jsxs(Ne,{children:[e.jsxs(v,{direction:"row",alignItems:"center",justifyContent:"space-between",mb:5,children:[e.jsxs(a,{variant:"h4",children:["Order ",u," [",j,"]"]}),j==="draft"&&e.jsxs(v,{direction:"row",spacing:2,children:[e.jsx(se,{handleCancelOrder:pe}),e.jsx(re,{handleSendOrder:xe})]})]}),Se,e.jsx(Be,{})]})}ae.propTypes={orderId:_.any};function it(){Qe();const{orderId:n}=Ae();return e.jsxs(e.Fragment,{children:[e.jsx(Fe,{children:e.jsx("title",{children:" Order Detail | BEX Sales "})}),e.jsx(ae,{orderId:n})]})}export{it as default};
