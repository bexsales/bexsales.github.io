import{r as c,j as e,x as g,P as O,w as K,S as v,y as _,T as i,G as Y,z as Z,C as S,F as P,E as T,W as ee}from"./index-BHWFRxnZ.js";import{P as te}from"./product-view-C8dpra7H.js";import{D as F,a as L,b as W,c as k,G as w}from"./Grid-DEj-BJUn.js";import{F as B,T as f,L as re}from"./LoadingButton-CQcYV1mh.js";import{C as oe}from"./customer-view-Dlfl-I1E.js";import{d as se,e as ne,b as le,T as q,a as d,f as ae}from"./search-fill--LxZXleW.js";import{C as ie}from"./Container-B3a9q_PM.js";import{C as de}from"./Card-zVvn7gIX.js";import{u as ce}from"./use-auth-BeHjI8Fj.js";import"./Select-CcBov7JU.js";import"./isMuiElement-BGJRYOxU.js";function z({onSelect:x}){const[j,u]=c.useState(!1),r=()=>{u(!0)},h=()=>{u(!1)},s=p=>{x(p),h()};return e.jsxs("div",{children:[e.jsx(g,{variant:"outlined",onClick:r,children:"Add Product"}),e.jsxs(F,{open:j,onClose:h,maxWidth:"xl",fullWidth:!0,children:[e.jsx(L,{children:"Products"}),e.jsx(W,{children:e.jsx(B,{sx:{width:"100%"},children:e.jsx(te,{onSelect:s,style:{width:"100%"}})})}),e.jsx(k,{children:e.jsx(g,{onClick:h,color:"primary",children:"Close"})})]})]})}z.propTypes={onSelect:O.func};function A({onSelect:x}){const[j,u]=c.useState(!1),r=()=>{u(!0)},h=()=>{u(!1)},s=p=>{x(p),h()};return e.jsxs("div",{children:[e.jsx(g,{variant:"outlined",onClick:r,children:"Set"}),e.jsxs(F,{open:j,onClose:h,maxWidth:"xl",fullWidth:!0,children:[e.jsx(L,{children:"Customers"}),e.jsx(W,{sx:{padding:0},children:e.jsx(B,{sx:{width:"100%"},children:e.jsx(oe,{onSelect:s,style:{width:"100%"}})})}),e.jsx(k,{children:e.jsx(g,{onClick:h,color:"primary",children:"Close"})})]})]})}A.propTypes={onSelect:O.func};function he(){const x=K(),[j,u]=c.useState(!1),[r,h]=c.useState({id:0,name:"",street:"",city:"",state:"",country:"",zip:"",phone:"",mobile:"",email:""}),[s,p]=c.useState([]),[b,D]=c.useState({}),[E,N]=c.useState(0),[R,U]=c.useState(0),[C,$]=c.useState(""),I=(t,n)=>{console.log("Fetching order totals");const a=`${T.baseURL}/api-proxy/proxy?method=post&resource=ordertotals`;console.log(a);const o=s.map(l=>({product_id:l.id,product_uom_qty:l.product_uom_qty})),m={partner_id:r.id,order_line:o};console.log("Request body",m),S.post(a,m,{headers:{Authorization:`Bearer ${P.get("jwt")}`}}).then(l=>{console.log(l.data),D(l.data.result.product_prices),N(l.data.result.subtotal),U(l.data.result.total)}).catch(l=>{console.error("Error fetching order totals:",l)})};c.useEffect(()=>{I()},[r,s]);const M=(t,n,a)=>{if(t<0||t>=s.length)return;const o=s.filter((m,l)=>l!==t);p(o)},G=(t,n)=>{const a=s.map((o,m)=>m===t?{...o,product_uom_qty:n!==0?Number(n):0}:o);p(a)},y=t=>t?`$${t.toFixed(2)}`:"",V=t=>{console.log("Setting order partner"),console.log(t),h({id:t.id,name:t.name,street:t.street,city:t.city,state:t.state,country:t.country,zip:t.zip,phone:t.phone,mobile:t.mobile,email:t.email})},H=t=>{console.log("Adding order line"),console.log(t),p([...s,{id:t.id,name:t.name,default_code:t.default_code,category:t.category,type:t.type,lst_price:t.lst_price,invoice_policy:t.invoice_policy,description_sale:t.description_sale,sale_ok:t.sale_ok,purchase_ok:t.purchase_ok,sales_count:t.sales_count,product_uom_qty:1}])},Q=t=>{$(t.target.value)},X=()=>{u(!0),console.log("Creating an order");const t=`${T.baseURL}/api-proxy/proxy?method=post&resource=orders`;console.log(t),console.log(s);const n=s.map(o=>({product_id:o.id,product_uom_qty:o.product_uom_qty}));console.log(n);const a={order:{partner_id:r.id,order_line:n,x_studio_notes:C}};console.log("Request body",a),S.post(t,a,{headers:{Authorization:`Bearer ${P.get("jwt")}`}}).then(o=>{console.log(o.data),u(!1),x.push(`/orders/${o.data.result.sale_order_id}`)}).catch(o=>{console.error("Error fetching customers:",o)})},J=e.jsxs(e.Fragment,{children:[e.jsx(v,{spacing:3,direction:"row",alignItems:"center",children:e.jsx(f,{fullWidth:!0,name:"partner_id",label:"Customer",value:r.name,InputProps:{readOnly:!0,endAdornment:e.jsx(_,{children:e.jsx(A,{onSelect:V})})}})}),r.name&&e.jsxs(e.Fragment,{children:[e.jsx("div",{style:{margin:"16px 0"}}),e.jsx(i,{variant:"body1",fontWeight:"bold",children:"Address:"}),e.jsx(i,{variant:"body1",children:r.street}),e.jsxs(i,{variant:"body1",children:[r.city," ",r.state]}),e.jsxs(i,{variant:"body1",children:[r.country," ",r.zip]}),e.jsxs(i,{variant:"body1",children:[e.jsx("b",{children:"Phone:"})," ",r.phone]}),e.jsxs(i,{variant:"body1",children:[e.jsx("b",{children:"Mobile:"})," ",r.mobile]}),e.jsxs(i,{variant:"body1",children:[e.jsx("b",{children:"Email:"})," ",r.email]})]}),e.jsx("div",{style:{margin:"16px 0"}}),e.jsx(_,{children:e.jsx(z,{onSelect:H})}),e.jsx("div",{style:{margin:"16px 0"}}),e.jsx(se,{component:Y,children:e.jsxs(ne,{children:[e.jsx(le,{children:e.jsxs(q,{children:[e.jsx(d,{children:"Product"}),e.jsx(d,{children:"Unit Price"}),e.jsx(d,{children:"Qty"}),e.jsx(d,{children:"Subtotal"}),e.jsx(d,{})]})}),e.jsx(ae,{children:s.map((t,n)=>e.jsxs(q,{children:[e.jsxs(d,{children:["[",t.default_code,"] ",t.name]}),e.jsx(d,{children:y(b[t.id])}),e.jsx(d,{children:e.jsx(f,{type:"number",style:{minWidth:"100px"},value:t.product_uom_qty!==0?t.product_uom_qty:"",onChange:a=>G(n,a.target.value)})}),e.jsx(d,{children:y(b[t.id]*t.product_uom_qty)}),e.jsx(d,{align:"right",children:e.jsx(_,{onClick:()=>M(n),children:e.jsx(Z,{icon:"eva:trash-2-outline"})})})]},n))})]})}),e.jsx("div",{style:{margin:"16px 0"}}),e.jsxs(i,{variant:"body1",fontWeight:"bold",children:["Subtotal: ",y(E)]}),e.jsxs(i,{variant:"body1",fontWeight:"bold",children:["Total: ",y(R)]}),e.jsx("div",{style:{margin:"16px 0"}}),e.jsx(w,{container:!0,spacing:2,children:e.jsx(w,{item:!0,xs:12,md:6,lg:6,children:e.jsx(f,{label:"Notes",value:C,multiline:!0,fullWidth:!0,rows:4,onChange:Q})})}),e.jsx("div",{style:{margin:"16px 0"}}),e.jsx(re,{fullWidth:!0,size:"large",type:"submit",variant:"contained",color:"inherit",onClick:X,loading:j,children:"Create"})]});return e.jsxs(ie,{children:[e.jsx(v,{direction:"row",alignItems:"center",justifyContent:"space-between",mb:5,children:e.jsx(i,{variant:"h4",children:"New Order"})}),J,e.jsx(de,{})]})}function ve(){return ce(),e.jsxs(e.Fragment,{children:[e.jsx(ee,{children:e.jsx("title",{children:" New Order | BEX Sales "})}),e.jsx(he,{})]})}export{ve as default};
