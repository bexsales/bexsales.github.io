import{r as h,j as e,x as g,P as w,w as H,S as b,y as _,T as i,H as Q,z as X,E as C,G as v,F as S,W as J}from"./index-TplErFoX.js";import{P as K}from"./product-view-CRCCvaW9.js";import{D as q,a as O,b as F,c as L}from"./DialogTitle-B_0lDu7d.js";import{F as k,T as P,L as Y}from"./LoadingButton-CDEUycIT.js";import{C as Z}from"./customer-view-eYzODj1Z.js";import{d as ee,e as te,b as re,T,a as d,f as oe}from"./search-fill-CfBoScM-.js";import{C as se}from"./Container-6loPtiAk.js";import{C as ne}from"./Card-B2ns9bOE.js";import{u as le}from"./use-auth-yADBN2vK.js";import"./Select-BZid7X93.js";import"./isMuiElement-BeOtBpW1.js";function W({onSelect:x}){const[j,u]=h.useState(!1),r=()=>{u(!0)},c=()=>{u(!1)},s=p=>{x(p),c()};return e.jsxs("div",{children:[e.jsx(g,{variant:"outlined",onClick:r,children:"Add Product"}),e.jsxs(q,{open:j,onClose:c,maxWidth:"xl",fullWidth:!0,children:[e.jsx(O,{children:"Products"}),e.jsx(F,{children:e.jsx(k,{sx:{width:"100%"},children:e.jsx(K,{onSelect:s,style:{width:"100%"}})})}),e.jsx(L,{children:e.jsx(g,{onClick:c,color:"primary",children:"Close"})})]})]})}W.propTypes={onSelect:w.func};function B({onSelect:x}){const[j,u]=h.useState(!1),r=()=>{u(!0)},c=()=>{u(!1)},s=p=>{x(p),c()};return e.jsxs("div",{children:[e.jsx(g,{variant:"outlined",onClick:r,children:"Set"}),e.jsxs(q,{open:j,onClose:c,maxWidth:"xl",fullWidth:!0,children:[e.jsx(O,{children:"Customers"}),e.jsx(F,{sx:{padding:0},children:e.jsx(k,{sx:{width:"100%"},children:e.jsx(Z,{onSelect:s,style:{width:"100%"}})})}),e.jsx(L,{children:e.jsx(g,{onClick:c,color:"primary",children:"Close"})})]})]})}B.propTypes={onSelect:w.func};function ae(){const x=H(),[j,u]=h.useState(!1),[r,c]=h.useState({id:0,name:"",street:"",city:"",state:"",country:"",zip:"",phone:"",mobile:"",email:""}),[s,p]=h.useState([]),[f,z]=h.useState({}),[A,D]=h.useState(0),[E,R]=h.useState(0),U=(t,n)=>{console.log("Fetching order totals");const a=`${S.baseURL}/api-proxy/proxy?method=post&resource=ordertotals`;console.log(a);const o=s.map(l=>({product_id:l.id,product_uom_qty:l.product_uom_qty})),m={partner_id:r.id,order_line:o};console.log("Request body",m),C.post(a,m,{headers:{Authorization:`Bearer ${v.get("jwt")}`}}).then(l=>{console.log(l.data),z(l.data.result.product_prices),D(l.data.result.subtotal),R(l.data.result.total)}).catch(l=>{console.error("Error fetching order totals:",l)})};h.useEffect(()=>{U()},[r,s]);const $=(t,n,a)=>{if(t<0||t>=s.length)return;const o=s.filter((m,l)=>l!==t);p(o)},I=(t,n)=>{const a=s.map((o,m)=>m===t?{...o,product_uom_qty:n!==0?Number(n):0}:o);p(a)},y=t=>t?`$${t.toFixed(2)}`:"",M=t=>{console.log("Setting order partner"),console.log(t),c({id:t.id,name:t.name,street:t.street,city:t.city,state:t.state,country:t.country,zip:t.zip,phone:t.phone,mobile:t.mobile,email:t.email})},N=t=>{console.log("Adding order line"),console.log(t),p([...s,{id:t.id,name:t.name,default_code:t.default_code,category:t.category,type:t.type,lst_price:t.lst_price,invoice_policy:t.invoice_policy,description_sale:t.description_sale,sale_ok:t.sale_ok,purchase_ok:t.purchase_ok,sales_count:t.sales_count,product_uom_qty:1}])},V=()=>{u(!0),console.log("Creating an order");const t=`${S.baseURL}/api-proxy/proxy?method=post&resource=orders`;console.log(t),console.log(s);const n=s.map(o=>({product_id:o.id,product_uom_qty:o.product_uom_qty}));console.log(n);const a={order:{partner_id:r.id,order_line:n}};console.log("Request body",a),C.post(t,a,{headers:{Authorization:`Bearer ${v.get("jwt")}`}}).then(o=>{console.log(o.data),u(!1),x.push(`/orders/${o.data.result.sale_order_id}`)}).catch(o=>{console.error("Error fetching customers:",o)})},G=e.jsxs(e.Fragment,{children:[e.jsx(b,{spacing:3,direction:"row",alignItems:"center",children:e.jsx(P,{fullWidth:!0,name:"partner_id",label:"Customer",value:r.name,InputProps:{readOnly:!0,endAdornment:e.jsx(_,{children:e.jsx(B,{onSelect:M})})}})}),r.name&&e.jsxs(e.Fragment,{children:[e.jsx("div",{style:{margin:"16px 0"}}),e.jsx(i,{variant:"body1",fontWeight:"bold",children:"Address:"}),e.jsx(i,{variant:"body1",children:r.street}),e.jsxs(i,{variant:"body1",children:[r.city," ",r.state]}),e.jsxs(i,{variant:"body1",children:[r.country," ",r.zip]}),e.jsxs(i,{variant:"body1",children:[e.jsx("b",{children:"Phone:"})," ",r.phone]}),e.jsxs(i,{variant:"body1",children:[e.jsx("b",{children:"Mobile:"})," ",r.mobile]}),e.jsxs(i,{variant:"body1",children:[e.jsx("b",{children:"Email:"})," ",r.email]})]}),e.jsx("div",{style:{margin:"16px 0"}}),e.jsx(_,{children:e.jsx(W,{onSelect:N})}),e.jsx("div",{style:{margin:"16px 0"}}),e.jsx(ee,{component:Q,children:e.jsxs(te,{children:[e.jsx(re,{children:e.jsxs(T,{children:[e.jsx(d,{children:"Product"}),e.jsx(d,{children:"Unit Price"}),e.jsx(d,{children:"Qty"}),e.jsx(d,{children:"Subtotal"}),e.jsx(d,{})]})}),e.jsx(oe,{children:s.map((t,n)=>e.jsxs(T,{children:[e.jsxs(d,{children:["[",t.default_code,"] ",t.name]}),e.jsx(d,{children:y(f[t.id])}),e.jsx(d,{children:e.jsx(P,{type:"number",style:{minWidth:"100px"},value:t.product_uom_qty!==0?t.product_uom_qty:"",onChange:a=>I(n,a.target.value)})}),e.jsx(d,{children:y(f[t.id]*t.product_uom_qty)}),e.jsx(d,{align:"right",children:e.jsx(_,{onClick:()=>$(n),children:e.jsx(X,{icon:"eva:trash-2-outline"})})})]},n))})]})}),e.jsx("div",{style:{margin:"16px 0"}}),e.jsxs(i,{variant:"body1",fontWeight:"bold",children:["Subtotal: ",y(A)]}),e.jsxs(i,{variant:"body1",fontWeight:"bold",children:["Total: ",y(E)]}),e.jsx("div",{style:{margin:"16px 0"}}),e.jsx(Y,{fullWidth:!0,size:"large",type:"submit",variant:"contained",color:"inherit",onClick:V,loading:j,children:"Create"})]});return e.jsxs(se,{children:[e.jsx(b,{direction:"row",alignItems:"center",justifyContent:"space-between",mb:5,children:e.jsx(i,{variant:"h4",children:"New Order"})}),G,e.jsx(ne,{})]})}function _e(){return le(),e.jsxs(e.Fragment,{children:[e.jsx(J,{children:e.jsx("title",{children:" New Order | BEX Sales "})}),e.jsx(ae,{})]})}export{_e as default};
