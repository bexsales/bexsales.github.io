import{r as d,j as e,x as _,P as W,w as re,S as P,C as f,T as c,G as oe,D as se,y as T,z as q,A as O,W as ne}from"./index-DjnQOM54.js";import{P as le,C as ae}from"./product-view-BEPZ_sA5.js";import{D as k,a as L,b as A,c as F,G as g}from"./Grid-ZnFQWzys.js";import{F as R,T as b,L as ie}from"./LoadingButton-C4PjP9Bz.js";import{C as de}from"./customer-view-3aL68qdl.js";import{d as ce,e as ue,b as he,T as w,a,f as xe}from"./search-fill-BvNxCuli.js";import{C as pe}from"./Container-DfVVQbpH.js";import{C as je}from"./Card-DZ2u7_05.js";import{u as ye}from"./use-auth-CVLE43qx.js";import"./Select-BEeQM-iL.js";import"./isMuiElement-he3bc5gG.js";function B({onSelect:p}){const[j,h]=d.useState(!1),o=()=>{h(!0)},u=()=>{h(!1)},n=x=>{p(x),u()};return e.jsxs("div",{children:[e.jsx(_,{variant:"outlined",onClick:o,children:"Add Product"}),e.jsxs(k,{open:j,onClose:u,maxWidth:"xl",fullWidth:!0,children:[e.jsx(L,{children:"Products"}),e.jsx(A,{children:e.jsx(R,{sx:{width:"100%"},children:e.jsx(le,{onSelect:n,style:{width:"100%"}})})}),e.jsx(F,{children:e.jsx(_,{onClick:u,color:"primary",children:"Close"})})]})]})}B.propTypes={onSelect:W.func};function D({onSelect:p}){const[j,h]=d.useState(!1),o=()=>{h(!0)},u=()=>{h(!1)},n=x=>{p(x),u()};return e.jsxs("div",{children:[e.jsx(_,{variant:"outlined",onClick:o,children:"Set"}),e.jsxs(k,{open:j,onClose:u,maxWidth:"xl",fullWidth:!0,children:[e.jsx(L,{children:"Customers"}),e.jsx(A,{sx:{padding:0},children:e.jsx(R,{sx:{width:"100%"},children:e.jsx(de,{onSelect:n,style:{width:"100%"}})})}),e.jsx(F,{children:e.jsx(_,{onClick:u,color:"primary",children:"Close"})})]})]})}D.propTypes={onSelect:W.func};function me(){const p=re(),[j,h]=d.useState(!1),[o,u]=d.useState({id:0,name:"",street:"",city:"",state:"",country:"",zip:"",phone:"",mobile:"",email:""}),[n,x]=d.useState([]),[v,z]=d.useState({}),[N,E]=d.useState(0),[U,$]=d.useState(0),[I,M]=d.useState(0),[C,Q]=d.useState(""),[S,G]=d.useState(""),V=(t,s)=>{console.log("Fetching order totals");const l=`${O.baseURL}/api-proxy/proxy?method=post&resource=ordertotals`;console.log(l);const r=n.map(i=>({product_id:i.id,product_uom_qty:i.product_uom_qty})),y={partner_id:o.id,order_line:r};console.log("Request body",y),T.post(l,y,{headers:{Authorization:`Bearer ${q.get("jwt")}`}}).then(i=>{console.log(i.data),z(i.data.result.product_prices),E(i.data.result.subtotal),$(i.data.result.total)}).catch(i=>{console.error("Error fetching order totals:",i)})};d.useEffect(()=>{V();const t=n.reduce((s,l)=>s+l.product_uom_qty,0);M(t)},[o,n]);const H=(t,s,l)=>{if(t<0||t>=n.length)return;const r=n.filter((y,i)=>i!==t);x(r)},X=(t,s)=>{const l=n.map((r,y)=>{if(y===t){console.log(r),console.log(s);const i=["consu","service"];return r.qty_available<s&&!i.includes(r.type)?(alert("Quantity available is insufficient."),r):{...r,product_uom_qty:s!==0?Number(s):0}}return r});x(l)},m=t=>t?`$${t.toFixed(2)}`:"",J=t=>{console.log("Setting order partner"),console.log(t),u({id:t.id,name:t.name,street:t.street,city:t.city,state:t.state,country:t.country,zip:t.zip,phone:t.phone,mobile:t.mobile,email:t.email})},K=t=>{console.log("Adding order line"),console.log(t);const s=["consu","service"];t.qty_available<1&&!s.includes(t.type)?alert("Cannot add product lines with 0 qty available"):x([...n,{id:t.id,name:t.name,default_code:t.default_code,category:t.category,type:t.type,lst_price:t.lst_price,invoice_policy:t.invoice_policy,description_sale:t.description_sale,attributes:t.attributes,sale_ok:t.sale_ok,purchase_ok:t.purchase_ok,sales_count:t.sales_count,product_uom_qty:1,qty_available:t.qty_available}])},Y=t=>{Q(t.target.value)},Z=t=>{G(t.target.value)},ee=()=>{h(!0),console.log("Creating an order");const t=`${O.baseURL}/api-proxy/proxy?method=post&resource=orders`;console.log(t),console.log(n);const s=n.map(r=>({product_id:r.id,product_uom_qty:r.product_uom_qty}));console.log(s);const l={order:{partner_id:o.id,order_line:s,x_studio_notes:C,client_order_ref:S}};console.log("Request body",l),T.post(t,l,{headers:{Authorization:`Bearer ${q.get("jwt")}`}}).then(r=>{console.log(r.data),h(!1),p.push(`/orders/${r.data.result.sale_order_id}`)}).catch(r=>{console.error("Error fetching customers:",r)})},te=e.jsxs(e.Fragment,{children:[e.jsx(P,{spacing:3,direction:"row",alignItems:"center",children:e.jsx(b,{fullWidth:!0,name:"partner_id",label:"Customer",value:o.name,InputProps:{readOnly:!0,endAdornment:e.jsx(f,{children:e.jsx(D,{onSelect:J})})}})}),o.name&&e.jsxs(e.Fragment,{children:[e.jsx("div",{style:{margin:"16px 0"}}),e.jsx(c,{variant:"body1",fontWeight:"bold",children:"Address:"}),e.jsx(c,{variant:"body1",children:o.street}),e.jsxs(c,{variant:"body1",children:[o.city," ",o.state]}),e.jsxs(c,{variant:"body1",children:[o.country," ",o.zip]}),e.jsxs(c,{variant:"body1",children:[e.jsx("b",{children:"Phone:"})," ",o.phone]}),e.jsxs(c,{variant:"body1",children:[e.jsx("b",{children:"Mobile:"})," ",o.mobile]}),e.jsxs(c,{variant:"body1",children:[e.jsx("b",{children:"Email:"})," ",o.email]})]}),e.jsx("div",{style:{margin:"16px 0"}}),e.jsx(f,{children:e.jsx(B,{onSelect:K})}),e.jsx("div",{style:{margin:"16px 0"}}),e.jsx(ce,{component:oe,children:e.jsxs(ue,{children:[e.jsx(he,{children:e.jsxs(w,{children:[e.jsx(a,{children:"Product"}),e.jsx(a,{children:"Attributes"}),e.jsx(a,{children:"Unit Price"}),e.jsx(a,{children:"Qty Available"}),e.jsx(a,{children:"Qty"}),e.jsx(a,{children:"Subtotal"}),e.jsx(a,{})]})}),e.jsx(xe,{children:n.map((t,s)=>e.jsxs(w,{children:[e.jsxs(a,{children:["[",t.default_code,"] ",t.name]}),e.jsx(a,{children:t.attributes.map((l,r)=>e.jsx(ae,{label:l,variant:"outlined"},r))}),e.jsx(a,{children:m(v[t.id])}),e.jsx(a,{children:t.qty_available}),e.jsx(a,{children:e.jsx(b,{type:"number",style:{minWidth:"100px"},value:t.product_uom_qty!==0?t.product_uom_qty:"",onChange:l=>X(s,l.target.value)})}),e.jsx(a,{children:m(v[t.id]*t.product_uom_qty)}),e.jsx(a,{align:"right",children:e.jsx(f,{onClick:()=>H(s),children:e.jsx(se,{icon:"eva:trash-2-outline"})})})]},s))})]})}),e.jsx("div",{style:{margin:"16px 0"}}),e.jsxs(c,{variant:"body1",fontWeight:"bold",children:["Total Product Qty: ",I]}),e.jsxs(c,{variant:"body1",fontWeight:"bold",children:["Subtotal: ",m(N)]}),e.jsxs(c,{variant:"body1",fontWeight:"bold",children:["Total: ",m(U)]}),e.jsx("div",{style:{margin:"16px 0"}}),e.jsx(g,{container:!0,spacing:2,children:e.jsx(g,{item:!0,xs:12,md:6,lg:6,children:e.jsx(b,{label:"Notes",value:C,multiline:!0,fullWidth:!0,rows:4,onChange:Y})})}),e.jsx("div",{style:{margin:"16px 0"}}),e.jsx(g,{container:!0,spacing:2,children:e.jsx(g,{item:!0,xs:12,md:6,lg:6,children:e.jsx(b,{label:"PO Number",value:S,fullWidth:!0,onChange:Z})})}),e.jsx("div",{style:{margin:"16px 0"}}),e.jsx(ie,{fullWidth:!0,size:"large",type:"submit",variant:"contained",color:"inherit",onClick:ee,loading:j,children:"Create"})]});return e.jsxs(pe,{children:[e.jsx(P,{direction:"row",alignItems:"center",justifyContent:"space-between",mb:5,children:e.jsx(c,{variant:"h4",children:"New Order"})}),te,e.jsx(je,{})]})}function we(){return ye(),e.jsxs(e.Fragment,{children:[e.jsx(ne,{children:e.jsx("title",{children:" New Order | BEX Sales "})}),e.jsx(me,{})]})}export{we as default};
