import{j as e,N as Y,T as q,P as p,k as Q,g as K,r as d,h as N,Y as De,Z as ke,l as I,_ as y,i as X,t as Re,a as Z,b as F,f as G,$ as we,A as le,y as ce,z as de,S as oe,B as H,x as ae,C as ue,D as $e,O as We,I as Ae,Q as Ne,R as _e}from"./index-Crk9S-oF.js";import{T as O,a as x,d as pe,e as he,b as xe,f as ge,c as Me,s as Be,g as Ie}from"./search-fill-CbA43ys8.js";import{a as Fe,O as qe,C as Oe}from"./CircularProgress-qJbvu80h.js";import{C as re}from"./Chip-D6rf1Zxw.js";import{T as Ee}from"./TextField-DK6ddPB0.js";import{C as Ue}from"./Container-D_rKHmn0.js";import{C as Le}from"./Card-Dm6Jyu88.js";const ze={border:0,margin:-1,padding:0,width:"1px",height:"1px",overflow:"hidden",position:"absolute",whiteSpace:"nowrap",clip:"rect(0 0 0 0)"};function Ve(t,a,s){return t?Math.max(0,(1+t)*a-s):0}function me({query:t}){return e.jsx(O,{children:e.jsx(x,{align:"center",colSpan:6,sx:{py:3},children:e.jsxs(Y,{sx:{textAlign:"center"},children:[e.jsx(q,{variant:"h6",paragraph:!0,children:"Not found"}),e.jsxs(q,{variant:"body2",children:["No results found for  ",e.jsxs("strong",{children:['"',t,'"']}),".",e.jsx("br",{})," Try checking for typos or using complete words."]})]})})})}me.propTypes={query:p.string};function fe({emptyRows:t,height:a}){return t?e.jsx(O,{sx:{...a&&{height:a*t}},children:e.jsx(x,{colSpan:9})}):null}fe.propTypes={emptyRows:p.number,height:p.number};function He(t){return K("MuiDialog",t)}const Ye=Q("MuiDialog",["root","scrollPaper","scrollBody","container","paper","paperScrollPaper","paperScrollBody","paperWidthFalse","paperWidthXs","paperWidthSm","paperWidthMd","paperWidthLg","paperWidthXl","paperFullWidth","paperFullScreen"]),se=Ye,Qe=d.createContext({}),be=Qe,Ke=["aria-describedby","aria-labelledby","BackdropComponent","BackdropProps","children","className","disableEscapeKeyDown","fullScreen","fullWidth","maxWidth","onBackdropClick","onClose","open","PaperComponent","PaperProps","scroll","TransitionComponent","transitionDuration","TransitionProps"],Xe=N(De,{name:"MuiDialog",slot:"Backdrop",overrides:(t,a)=>a.backdrop})({zIndex:-1}),Ze=t=>{const{classes:a,scroll:s,maxWidth:l,fullWidth:i,fullScreen:n}=t,u={root:["root"],container:["container",`scroll${I(s)}`],paper:["paper",`paperScroll${I(s)}`,`paperWidth${I(String(l))}`,i&&"paperFullWidth",n&&"paperFullScreen"]};return G(u,He,a)},Ge=N(ke,{name:"MuiDialog",slot:"Root",overridesResolver:(t,a)=>a.root})({"@media print":{position:"absolute !important"}}),Je=N("div",{name:"MuiDialog",slot:"Container",overridesResolver:(t,a)=>{const{ownerState:s}=t;return[a.container,a[`scroll${I(s.scroll)}`]]}})(({ownerState:t})=>y({height:"100%","@media print":{height:"auto"},outline:0},t.scroll==="paper"&&{display:"flex",justifyContent:"center",alignItems:"center"},t.scroll==="body"&&{overflowY:"auto",overflowX:"hidden",textAlign:"center","&:after":{content:'""',display:"inline-block",verticalAlign:"middle",height:"100%",width:"0"}})),et=N(Y,{name:"MuiDialog",slot:"Paper",overridesResolver:(t,a)=>{const{ownerState:s}=t;return[a.paper,a[`scrollPaper${I(s.scroll)}`],a[`paperWidth${I(String(s.maxWidth))}`],s.fullWidth&&a.paperFullWidth,s.fullScreen&&a.paperFullScreen]}})(({theme:t,ownerState:a})=>y({margin:32,position:"relative",overflowY:"auto","@media print":{overflowY:"visible",boxShadow:"none"}},a.scroll==="paper"&&{display:"flex",flexDirection:"column",maxHeight:"calc(100% - 64px)"},a.scroll==="body"&&{display:"inline-block",verticalAlign:"middle",textAlign:"left"},!a.maxWidth&&{maxWidth:"calc(100% - 64px)"},a.maxWidth==="xs"&&{maxWidth:t.breakpoints.unit==="px"?Math.max(t.breakpoints.values.xs,444):`max(${t.breakpoints.values.xs}${t.breakpoints.unit}, 444px)`,[`&.${se.paperScrollBody}`]:{[t.breakpoints.down(Math.max(t.breakpoints.values.xs,444)+32*2)]:{maxWidth:"calc(100% - 64px)"}}},a.maxWidth&&a.maxWidth!=="xs"&&{maxWidth:`${t.breakpoints.values[a.maxWidth]}${t.breakpoints.unit}`,[`&.${se.paperScrollBody}`]:{[t.breakpoints.down(t.breakpoints.values[a.maxWidth]+32*2)]:{maxWidth:"calc(100% - 64px)"}}},a.fullWidth&&{width:"calc(100% - 64px)"},a.fullScreen&&{margin:0,width:"100%",maxWidth:"100%",height:"100%",maxHeight:"none",borderRadius:0,[`&.${se.paperScrollBody}`]:{margin:0,maxWidth:"100%"}})),tt=d.forwardRef(function(a,s){const l=X({props:a,name:"MuiDialog"}),i=Re(),n={enter:i.transitions.duration.enteringScreen,exit:i.transitions.duration.leavingScreen},{"aria-describedby":u,"aria-labelledby":g,BackdropComponent:b,BackdropProps:j,children:C,className:w,disableEscapeKeyDown:$=!1,fullScreen:P=!1,fullWidth:v=!1,maxWidth:E="sm",onBackdropClick:f,onClose:k,open:_,PaperComponent:M=Y,PaperProps:R={},scroll:o="paper",TransitionComponent:r=we,transitionDuration:c=n,TransitionProps:m}=l,S=Z(l,Ke),T=y({},l,{disableEscapeKeyDown:$,fullScreen:P,fullWidth:v,maxWidth:E,scroll:o}),B=Ze(T),W=d.useRef(),J=A=>{W.current=A.target===A.currentTarget},ee=A=>{W.current&&(W.current=null,f&&f(A),k&&k(A,"backdropClick"))},U=Fe(g),te=d.useMemo(()=>({titleId:U}),[U]);return e.jsx(Ge,y({className:F(B.root,w),closeAfterTransition:!0,components:{Backdrop:Xe},componentsProps:{backdrop:y({transitionDuration:c,as:b},j)},disableEscapeKeyDown:$,onClose:k,open:_,ref:s,onClick:ee,ownerState:T},S,{children:e.jsx(r,y({appear:!0,in:_,timeout:c,role:"presentation"},m,{children:e.jsx(Je,{className:F(B.container),onMouseDown:J,ownerState:T,children:e.jsx(et,y({as:M,elevation:24,role:"dialog","aria-describedby":u,"aria-labelledby":U},R,{className:F(B.paper,R.className),ownerState:T,children:e.jsx(be.Provider,{value:te,children:C})}))})}))}))}),at=tt;function st(t){return K("MuiDialogActions",t)}Q("MuiDialogActions",["root","spacing"]);const ot=["className","disableSpacing"],nt=t=>{const{classes:a,disableSpacing:s}=t;return G({root:["root",!s&&"spacing"]},st,a)},it=N("div",{name:"MuiDialogActions",slot:"Root",overridesResolver:(t,a)=>{const{ownerState:s}=t;return[a.root,!s.disableSpacing&&a.spacing]}})(({ownerState:t})=>y({display:"flex",alignItems:"center",padding:8,justifyContent:"flex-end",flex:"0 0 auto"},!t.disableSpacing&&{"& > :not(style) ~ :not(style)":{marginLeft:8}})),rt=d.forwardRef(function(a,s){const l=X({props:a,name:"MuiDialogActions"}),{className:i,disableSpacing:n=!1}=l,u=Z(l,ot),g=y({},l,{disableSpacing:n}),b=nt(g);return e.jsx(it,y({className:F(b.root,i),ownerState:g,ref:s},u))}),lt=rt;function ct(t){return K("MuiDialogContent",t)}Q("MuiDialogContent",["root","dividers"]);function dt(t){return K("MuiDialogTitle",t)}const ut=Q("MuiDialogTitle",["root"]),pt=ut,ht=["className","dividers"],xt=t=>{const{classes:a,dividers:s}=t;return G({root:["root",s&&"dividers"]},ct,a)},gt=N("div",{name:"MuiDialogContent",slot:"Root",overridesResolver:(t,a)=>{const{ownerState:s}=t;return[a.root,s.dividers&&a.dividers]}})(({theme:t,ownerState:a})=>y({flex:"1 1 auto",WebkitOverflowScrolling:"touch",overflowY:"auto",padding:"20px 24px"},a.dividers?{padding:"16px 24px",borderTop:`1px solid ${(t.vars||t).palette.divider}`,borderBottom:`1px solid ${(t.vars||t).palette.divider}`}:{[`.${pt.root} + &`]:{paddingTop:0}})),mt=d.forwardRef(function(a,s){const l=X({props:a,name:"MuiDialogContent"}),{className:i,dividers:n=!1}=l,u=Z(l,ht),g=y({},l,{dividers:n}),b=xt(g);return e.jsx(gt,y({className:F(b.root,i),ownerState:g,ref:s},u))}),ft=mt,bt=["className","id"],yt=t=>{const{classes:a}=t;return G({root:["root"]},dt,a)},jt=N(q,{name:"MuiDialogTitle",slot:"Root",overridesResolver:(t,a)=>a.root})({padding:"16px 24px",flex:"0 0 auto"}),vt=d.forwardRef(function(a,s){const l=X({props:a,name:"MuiDialogTitle"}),{className:i,id:n}=l,u=Z(l,bt),g=l,b=yt(g),{titleId:j=n}=d.useContext(be);return e.jsx(jt,y({component:"h2",className:F(b.root,i),ownerState:g,ref:s,variant:"h6",id:n??j},u))}),Ct=vt;function ye({open:t,onClose:a,product:s,onSelect:l}){var M,R;const[i,n]=d.useState(null),[u,g]=d.useState({}),[b,j]=d.useState("..."),[C,w]=d.useState([]),$=o=>{w(r=>r.filter(c=>c.id!==o))},P=(M=s==null?void 0:s.attributes)==null?void 0:M.every(o=>u[o.attribute]),v=d.useCallback(()=>{if(!P)return;console.log("Fetching Product Variant"),j("Searching...");const o=Object.values(u).join(",");let r=`${le.baseURL}/api-proxy/proxy?method=get&resource=products&template_id=${s.id}`;o&&(r+=`&attributes=${o}`),r+="&include_images=true",console.log(r),ce.get(r,{headers:{Authorization:`Bearer ${de.get("jwt")}`}}).then(c=>{console.log(c.data.data),c.data.data&&Object.keys(c.data.data).length>0?o?n(c.data.data):Array.isArray(c.data.data)&&c.data.data.length>0&&n(c.data.data[0]):(n(null),j("Product not found..."))}).catch(c=>{console.error("Error fetching products:",c)})},[P,s.id,u]);d.useEffect(()=>{P&&v()},[P,v]),d.useEffect(()=>{if(i){const o=i.product_template_attribute_value_ids.map(T=>T.name).join(","),{default_code:r,name:c,qty_available:m}=i,S=`${r?`[${r}] `:""}${c}${o?` (${o})`:""}: ${m} available`;j(S)}else j("Product not found...")},[i]);const E=(o,r)=>{g({...u,[o]:r})},f=()=>{if(!Array.isArray(C)||C.length===0){alert("You must select at least one product variant before adding to order.");return}const o=C.map(r=>({...r,attributes:r.product_template_attribute_value_ids,product_template_attribute_value_ids:void 0}));console.log("Final cleaned products to add:",o),l(o)},k=(o,r)=>{const c=parseInt(r,10);w(m=>m.map(S=>S.id===o?{...S,qty_needed:Number.isNaN(c)?"":c}:S))},_=()=>{if(!i){alert("You must have a variant selected! Please select one value for each variant.");return}const o={...i,qty_needed:1};w(r=>r.find(m=>m.id===o.id)?r.map(m=>m.id===o.id?{...m,qty_needed:m.qty_needed+1}:m):[...r,o])};return e.jsxs(at,{open:t,onClose:a,maxWidth:"lg",fullWidth:!0,children:[(s==null?void 0:s.name)&&e.jsx(Ct,{id:"product-variant-title",variant:"h6",sx:{mb:2},children:s.name}),e.jsxs(ft,{dividers:!0,sx:{maxHeight:"70vh",overflowY:"auto"},children:[(R=s==null?void 0:s.attributes)==null?void 0:R.map(o=>e.jsxs(oe,{spacing:1,sx:{mb:2},children:[e.jsx(q,{variant:"subtitle1",children:o.attribute}),e.jsx(H,{sx:{display:"flex",flexWrap:"wrap",gap:1,maxHeight:150,overflowY:"auto",border:"1px solid #ccc",padding:1,borderRadius:1},children:o.values.map((r,c)=>e.jsx(re,{label:r[1],clickable:!0,color:u[o.attribute]===r[1]?"primary":"default",onClick:()=>E(o.attribute,r[1]),sx:{borderRadius:"5px",fontWeight:u[o.attribute]===r[1]?"bold":"normal"}},c))})]},o.id)),b&&e.jsxs(H,{sx:{mt:2,p:2,border:"1px solid #ccc",borderRadius:1,backgroundColor:"#f5f5f5",display:"flex",alignItems:"center",justifyContent:"space-between"},children:[e.jsx(q,{variant:"subtitle1",children:b}),e.jsx(ae,{variant:"contained",color:"primary",onClick:_,disabled:!P,children:"Add"})]}),C.length>0&&e.jsx(H,{sx:{mt:3},children:e.jsx(pe,{component:Y,children:e.jsxs(he,{children:[e.jsx(xe,{children:e.jsxs(O,{children:[e.jsx(x,{children:" ".repeat(30)}),e.jsx(x,{children:"Product"}),e.jsx(x,{children:"Attributes"}),e.jsx(x,{children:"Qty Available"}),e.jsx(x,{children:"Qty Needed"}),e.jsx(x,{})," "]})}),e.jsx(ge,{children:C.map(o=>{var r;return e.jsxs(O,{children:[e.jsx(x,{children:o.image&&e.jsx("img",{src:`data:image/png;base64,${o.image}`,alt:o.name,style:{width:"100px",height:"100px"}})}),e.jsxs(x,{children:[o.default_code?`[${o.default_code}] `:"",o.name]}),e.jsx(x,{children:(r=o.product_template_attribute_value_ids)==null?void 0:r.map(c=>e.jsx(re,{label:c.name,size:"small"},c.id))}),e.jsx(x,{children:o.qty_available}),e.jsx(x,{children:e.jsx(Ee,{type:"number",size:"small",value:o.qty_needed,onChange:c=>k(o.id,c.target.value),onBlur:c=>{const m=parseInt(c.target.value,10);(!m||m<1)&&k(o.id,1)},inputProps:{min:1}})}),e.jsx(x,{children:e.jsx(ue,{onClick:()=>$(o.id),children:e.jsx($e,{icon:"eva:trash-2-outline"})})})]},o.id)})})]})})})]}),e.jsxs(lt,{children:[e.jsx(ae,{onClick:a,children:"Cancel"}),e.jsx(ae,{onClick:f,disabled:!P,children:"Add to Order"})]})]})}ye.propTypes={open:p.bool.isRequired,onClose:p.func.isRequired,product:p.object,onSelect:p.func};function je({id:t,image:a,name:s,category:l,type:i,list_price:n,attributes:u,onSelect:g}){const b=j=>`$${j.toFixed(2)}`;return e.jsxs(O,{hover:!0,tabIndex:-1,onClick:()=>g({id:t,image:a,name:s,category:l,type:i,list_price:n,attributes:u}),children:[e.jsx(x,{children:a&&e.jsx("img",{src:`data:image/png;base64,${a}`,alt:s,style:{width:"100px",height:"100px"}})}),e.jsx(x,{children:s}),e.jsx(x,{children:l}),e.jsx(x,{children:i}),e.jsx(x,{children:b(n)})]})}je.propTypes={id:p.any,image:p.any,name:p.any,category:p.any,type:p.any,list_price:p.any,attributes:p.arrayOf(p.string),onSelect:p.func};function ve({order:t,orderBy:a,headLabel:s,onRequestSort:l}){const i=n=>u=>{l(u,n)};return e.jsx(xe,{children:e.jsx(O,{children:s.map(n=>e.jsx(x,{align:n.align||"left",sortDirection:a===n.id?t:!1,sx:{width:n.width,minWidth:n.minWidth},children:e.jsxs(Me,{hideSortIcon:!0,active:a===n.id,direction:a===n.id?t:"desc",onClick:i(n.id),children:[n.label,a===n.id?e.jsx(H,{sx:{...ze},children:t==="desc"?"sorted descending":"sorted ascending"}):null]})},n.id))})})}ve.propTypes={order:p.oneOf(["asc","desc"]),orderBy:p.string,headLabel:p.array,onRequestSort:p.func};function Ce({filterName:t,onFilterName:a,onClickSearch:s,onHitEnter:l}){return e.jsx(We,{sx:{height:96,display:"flex",justifyContent:"space-between",p:i=>i.spacing(0,1,0,3)},children:e.jsx(qe,{value:t,onChange:a,onKeyDown:l,placeholder:"Search product...",endAdornment:e.jsx(Ae,{position:"end",children:e.jsx(ue,{onClick:s,edge:"end",children:e.jsx(Ne,{icon:Be,sx:{color:"text.disabled",width:20,height:20}})})})})})}Ce.propTypes={filterName:p.string,onFilterName:p.func,onClickSearch:p.func,onHitEnter:p.func};function Pt({showTitle:t,onSelect:a}){const[s,l]=d.useState(!1),[i,n]=d.useState([]),[u,g]=d.useState(0),[b,j]=d.useState(0),[C,w]=d.useState("asc"),[$,P]=d.useState("name"),[v,E]=d.useState(""),[f,k]=d.useState(25),[_,M]=d.useState(0),[R,o]=d.useState(!1),[r,c]=d.useState(null),m=d.useRef(i),S=d.useRef(f),T=d.useRef(u),B=d.useRef(v);d.useEffect(()=>{m.current=i,S.current=f,T.current=u,B.current=v,W(T.current,S.current,m.current,B.current)},[]);const W=(h,D,L,ie)=>{console.log("Fetching Products"),l(!0);const Te=h+1;let V=`${le.baseURL}/api-proxy/proxy?method=get&resource=product-templates&page=${Te}&page_size=${D}`;ie&&(V+=`&name=${ie}`),V+="&include_images=true",console.log(V),ce.get(V,{headers:{Authorization:`Bearer ${de.get("jwt")}`}}).then(z=>{console.log(z.data.data),n([...L,...z.data.data]),M(z.data.count)}).catch(z=>{console.error("Error fetching products:",z)}).finally(()=>{l(!1)})},J=(h,D)=>{D!==""&&(w($===D&&C==="asc"?"desc":"asc"),P(D))},ee=(h,D)=>{g(D);const L=f*D;window.scrollTo({top:0,behavior:"smooth"}),L>b&&(j(L),W(D,f,i,v))},U=h=>{g(0),k(parseInt(h.target.value,10))},te=h=>{E(h.target.value)},A=h=>{h.key==="Enter"&&ne()},ne=h=>{g(0),W(u,f,[],v)},Pe=h=>{c(h),o(!0)},Se=!i.length&&!!v;return e.jsxs(e.Fragment,{children:[s&&e.jsx(oe,{sx:{position:"fixed",top:0,left:0,width:"100vw",height:"100vh",bgcolor:"rgba(255, 255, 255, 0.6)",zIndex:2e3,display:"flex",alignItems:"center",justifyContent:"center"},children:e.jsx(Oe,{})}),e.jsxs(Ue,{children:[t&&e.jsx(oe,{direction:"row",alignItems:"center",justifyContent:"space-between",mb:5,children:e.jsx(q,{variant:"h4",children:"Products"})}),e.jsxs(Le,{children:[e.jsx(Ce,{filterName:v,onFilterName:te,onClickSearch:ne,onHitEnter:A}),e.jsx(_e,{children:e.jsx(pe,{sx:{overflow:"unset"},children:e.jsxs(he,{sx:{minWidth:800},children:[e.jsx(ve,{order:C,orderBy:$,rowCount:i.length,onRequestSort:J,headLabel:[{id:"image",label:" ".repeat(30)},{id:"name",label:"Name"},{id:"category",label:"Category"},{id:"type",label:"Type"},{id:"lst_price",label:"Sale Price"}]}),e.jsxs(ge,{children:[i.slice(u*f,u*f+f).map(h=>e.jsx(je,{id:h.id,image:h.image,name:h.name,category:h.categ_id.name,type:h.type,list_price:h.list_price,attributes:h.attribute_line_ids,onSelect:Pe},h.id)),e.jsx(fe,{height:77,emptyRows:Ve(u,f,i.length)}),Se&&e.jsx(me,{query:v})]})]})})}),e.jsx(Ie,{page:u,component:"div",count:_,rowsPerPage:f,onPageChange:ee,rowsPerPageOptions:[25],onRowsPerPageChange:U})]}),R&&e.jsx(ye,{open:R,onClose:()=>o(!1),product:r,onSelect:a})]})]})}Pt.propTypes={showTitle:p.bool,onSelect:p.func};export{at as D,Pt as P,Ct as a,ft as b,lt as c};
