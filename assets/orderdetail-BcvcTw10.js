import{g as ue,k as he,h as xe,T as p,M as pe,r as n,i as me,a as je,j as e,_ as G,b as ge,f as ye,x as b,P as T,S as q,y as v,z as V,C as O,F as P,G as fe,E as w,N as Ce,W as be}from"./index-Br3zQ_dX.js";import{P as _e}from"./product-view-s10vIiPi.js";import{D as L,a as F,b as U,c as W,G as z}from"./Grid-DPQ7qUSR.js";import{F as H,T as D,L as Se}from"./LoadingButton-DDaGfJtr.js";import{C as ve}from"./customer-view-QS-8TNDi.js";import{d as Te,e as Oe,b as Pe,T as I,a as j,f as we}from"./search-fill-B5x2dEDj.js";import{C as De}from"./Container-CJV_QVWt.js";import{C as qe}from"./Card-BVfvgfX2.js";import{u as Le}from"./use-auth-_NjdyKcq.js";import"./Select-D3cNMV0p.js";import"./isMuiElement-D9_3ay8R.js";function Fe(r){return ue("MuiDialogContentText",r)}he("MuiDialogContentText",["root"]);const Ue=["children","className"],We=r=>{const{classes:a}=r,d=ye({root:["root"]},Fe,a);return G({},a,d)},$e=xe(p,{shouldForwardProp:r=>pe(r)||r==="classes",name:"MuiDialogContentText",slot:"Root",overridesResolver:(r,a)=>a.root})({}),ke=n.forwardRef(function(a,l){const d=me({props:a,name:"MuiDialogContentText"}),{className:i}=d,g=je(d,Ue),y=We(g);return e.jsx($e,G({component:"p",variant:"body1",color:"text.secondary",ref:l,ownerState:g,className:ge(y.root,i)},d,{classes:y}))}),Ae=ke;function Q({onSelect:r}){const[a,l]=n.useState(!1),d=()=>{l(!0)},i=()=>{l(!1)},g=y=>{r(y),i()};return e.jsxs("div",{children:[e.jsx(b,{variant:"outlined",onClick:d,children:"Add Product"}),e.jsxs(L,{open:a,onClose:i,maxWidth:"xl",fullWidth:!0,children:[e.jsx(F,{children:"Products"}),e.jsx(U,{children:e.jsx(H,{sx:{width:"100%"},children:e.jsx(_e,{onSelect:g,style:{width:"100%"}})})}),e.jsx(W,{children:e.jsx(b,{onClick:i,color:"primary",children:"Close"})})]})]})}Q.propTypes={onSelect:T.func};function X({onSelect:r}){const[a,l]=n.useState(!1),d=()=>{l(!0)},i=()=>{l(!1)},g=y=>{r(y),i()};return e.jsxs("div",{children:[e.jsx(b,{variant:"outlined",onClick:d,children:"Set"}),e.jsxs(L,{open:a,onClose:i,maxWidth:"xl",fullWidth:!0,children:[e.jsx(F,{children:"Customers"}),e.jsx(U,{sx:{padding:0},children:e.jsx(H,{sx:{width:"100%"},children:e.jsx(ve,{onSelect:g,style:{width:"100%"}})})}),e.jsx(W,{children:e.jsx(b,{onClick:i,color:"primary",children:"Close"})})]})]})}X.propTypes={onSelect:T.func};function J({handleCancelOrder:r}){const[a,l]=n.useState(!1),d=()=>{l(!0)},i=()=>{l(!1)};return e.jsxs(q,{direction:"row",alignItems:"center",children:[e.jsx(p,{variant:"body1",sx:{color:"red"},children:"Cancel"}),e.jsxs(v,{onClick:d,sx:{color:"red"},children:[e.jsx(V,{icon:"eva:close-outline"})," "]}),e.jsxs(L,{open:a,onClose:i,"aria-labelledby":"alert-dialog-title","aria-describedby":"alert-dialog-description",children:[e.jsx(F,{id:"alert-dialog-title",children:"Confirm Cancellation"}),e.jsx(U,{children:e.jsx(Ae,{id:"alert-dialog-description",children:"Are you sure you want to cancel this order?"})}),e.jsxs(W,{children:[e.jsx(b,{onClick:i,color:"primary",children:"Cancel"}),e.jsx(b,{onClick:r,color:"primary",autoFocus:!0,children:"Confirm"})]})]})]})}J.propTypes={handleCancelOrder:T.func};function K({orderId:r}){const[a,l]=n.useState(!1),[d,i]=n.useState(""),[g,y]=n.useState(""),[c,$]=n.useState({id:0,name:"",street:"",city:"",state:"",country:"",zip:"",phone:"",mobile:"",email:""}),[m,_]=n.useState([]),[k,Y]=n.useState([]),[A,Z]=n.useState({}),[ee,M]=n.useState(0),[te,R]=n.useState(0),[B,E]=n.useState("");n.useEffect(()=>{le()},[]);const oe=()=>{N(!0)},re=(t,o)=>{console.log("Fetching order totals");const u=`${w.baseURL}/api-proxy/proxy?method=post&resource=ordertotals`;console.log(u);const s=m.map(h=>({product_id:h[2].id,product_uom_qty:h[2].product_uom_qty})),f={partner_id:c.id,order_line:s};console.log("Request body",f),O.post(u,f,{headers:{Authorization:`Bearer ${P.get("jwt")}`}}).then(h=>{console.log(h.data),Z(h.data.result.product_prices),M(h.data.result.subtotal),R(h.data.result.total)}).catch(h=>{console.error("Error fetching order totals:",h)})};n.useEffect(()=>{re()},[c,m]);const se=t=>{E(t.target.value)},N=t=>{l(!0),console.log("Saving Order");let o="post";t===!0&&(o="cancel");const u=`${w.baseURL}/api-proxy/proxy?method=${o}&resource=orders`;console.log(u),console.log(m);const s=m.map(x=>[x[0],x[1],{product_id:x[2].id,product_uom_qty:x[2].product_uom_qty}]),f=k.map(x=>[2,x[1],{}]),h=s.concat(f),C={order:{id:parseInt(r,10),partner_id:c.id,order_line:h,x_studio_notes:B}};console.log("Request body",C),O.post(u,C,{headers:{Authorization:`Bearer ${P.get("jwt")}`}}).then(x=>{console.log(x.data),l(!1),x.data.result.success===!1?alert(x.data.result.message):window.location.reload()}).catch(x=>{console.error("Error saving order:",x)})},ne=(t,o,u)=>{if(t<0||t>=m.length)return;const s=m.filter((h,C)=>C===t);s[0][0]!==0&&(console.log("Adding line to delete queue",s),Y(k.concat(s)));const f=m.filter((h,C)=>C!==t);_(f)},ae=(t,o)=>{const u=m.map((s,f)=>f===t?(console.log("handle qty change",s),[s[0],s[1],{...s[2],product_uom_qty:o!==0?Number(o):0}]):s);_(u)},S=t=>t?`$${t.toFixed(2)}`:"",le=()=>{console.log("Fetching Order Details");const t=`${w.baseURL}/api-proxy/proxy?method=get&resource=orders&order_id=${r}`;console.log(t),O.get(t,{headers:{Authorization:`Bearer ${P.get("jwt")}`}}).then(o=>{console.log(o.data.data),i(o.data.data.name),$(o.data.data.customer_id),E(o.data.data.x_studio_notes);const u=o.data.data.order_line.map(s=>[1,s.id,{line_id:s.id,id:s.product_id.id,name:s.name,product_uom_qty:s.product_uom_qty}]);console.log(u),_(u),M(o.data.data.amount_untaxed),R(o.data.data.amount_total),y(o.data.data.state)}).catch(o=>{console.error("Error fetching order details:",o)})},ie=t=>{console.log("Setting order partner"),console.log(t),$({id:t.id,name:t.name,street:t.street,city:t.city,state:t.state,country:t.country,zip:t.zip,phone:t.phone,mobile:t.mobile,email:t.email})},de=t=>{console.log("Adding order line"),console.log(t),_([...m,[0,0,{id:t.id,name:`[${t.default_code}] ${t.name}`,product_uom_qty:1}]])},ce=e.jsxs(e.Fragment,{children:[e.jsx(q,{spacing:3,direction:"row",alignItems:"center",children:e.jsx(D,{fullWidth:!0,name:"partner_id",label:"Customer",value:c.name,InputProps:{readOnly:!0,endAdornment:e.jsx(v,{children:e.jsx(X,{onSelect:ie})})}})}),c.name&&e.jsxs(e.Fragment,{children:[e.jsx("div",{style:{margin:"16px 0"}}),e.jsx(p,{variant:"body1",fontWeight:"bold",children:"Address:"}),e.jsx(p,{variant:"body1",children:c.street}),e.jsxs(p,{variant:"body1",children:[c.city," ",c.state]}),e.jsxs(p,{variant:"body1",children:[c.country," ",c.zip]}),e.jsxs(p,{variant:"body1",children:[e.jsx("b",{children:"Phone:"})," ",c.phone]}),e.jsxs(p,{variant:"body1",children:[e.jsx("b",{children:"Mobile:"})," ",c.mobile]}),e.jsxs(p,{variant:"body1",children:[e.jsx("b",{children:"Email:"})," ",c.email]})]}),e.jsx(v,{children:e.jsx(Q,{onSelect:de})}),e.jsx("div",{style:{margin:"16px 0"}}),e.jsx(Te,{component:fe,children:e.jsxs(Oe,{children:[e.jsx(Pe,{children:e.jsxs(I,{children:[e.jsx(j,{children:"Product"}),e.jsx(j,{children:"Unit Price"}),e.jsx(j,{children:"Qty"}),e.jsx(j,{children:"Subtotal"}),e.jsx(j,{})]})}),e.jsx(we,{children:m.map((t,o)=>e.jsxs(I,{children:[e.jsx(j,{children:t[2].name}),e.jsx(j,{children:S(A[t[2].id])}),e.jsx(j,{children:e.jsx(D,{type:"number",style:{minWidth:"100px"},value:t[2].product_uom_qty!==0?t[2].product_uom_qty:"",onChange:u=>ae(o,u.target.value)})}),e.jsx(j,{children:S(A[t[2].id]*t[2].product_uom_qty)}),e.jsx(j,{align:"right",children:e.jsx(v,{onClick:()=>ne(o),children:e.jsx(V,{icon:"eva:trash-2-outline"})})})]},o))})]})}),e.jsx("div",{style:{margin:"16px 0"}}),e.jsxs(p,{variant:"body1",fontWeight:"bold",children:["Subtotal: ",S(ee)]}),e.jsxs(p,{variant:"body1",fontWeight:"bold",children:["Total: ",S(te)]}),e.jsx("div",{style:{margin:"16px 0"}}),e.jsx(z,{container:!0,spacing:2,children:e.jsx(z,{item:!0,xs:12,md:6,lg:6,children:e.jsx(D,{label:"Notes",value:B,multiline:!0,fullWidth:!0,rows:4,onChange:se})})}),e.jsx("div",{style:{margin:"16px 0"}}),e.jsx(Se,{fullWidth:!0,size:"large",type:"submit",variant:"contained",color:"inherit",onClick:N,loading:a,children:"Save"})]});return e.jsxs(De,{children:[e.jsxs(q,{direction:"row",alignItems:"center",justifyContent:"space-between",mb:5,children:[e.jsxs(p,{variant:"h4",children:["Order ",d," [",g,"]"]}),g==="draft"&&e.jsx(J,{handleCancelOrder:oe})]}),ce,e.jsx(qe,{})]})}K.propTypes={orderId:T.any};function Xe(){Le();const{orderId:r}=Ce();return e.jsxs(e.Fragment,{children:[e.jsx(be,{children:e.jsx("title",{children:" Order Detail | BEX Sales "})}),e.jsx(K,{orderId:r})]})}export{Xe as default};
