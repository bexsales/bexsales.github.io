import{r as a,j as e,x as f,P as W,w as re,S as P,y as b,T as d,G as oe,z as se,C as T,F as w,E as O,W as ne}from"./index-B8DdthNH.js";import{P as le}from"./product-view-BrXtzTgE.js";import{D as F,a as L,b as k,c as R,G as g}from"./Grid-BdMT6fcE.js";import{F as B,T as _,L as ae}from"./LoadingButton-C_C39sY-.js";import{C as ie}from"./customer-view-D4LqNlfX.js";import{d as de,e as ce,b as ue,T as q,a as c,f as he}from"./search-fill-BCIY0mPt.js";import{C as xe}from"./Container-DgwCG4qh.js";import{C as pe}from"./Card-Z0OQqWNB.js";import{u as je}from"./use-auth-CcEPYmc4.js";import"./Select-B-Wb-ekU.js";import"./isMuiElement-S3DAsH90.js";function z({onSelect:p}){const[j,h]=a.useState(!1),r=()=>{h(!0)},u=()=>{h(!1)},o=x=>{p(x),u()};return e.jsxs("div",{children:[e.jsx(f,{variant:"outlined",onClick:r,children:"Add Product"}),e.jsxs(F,{open:j,onClose:u,maxWidth:"xl",fullWidth:!0,children:[e.jsx(L,{children:"Products"}),e.jsx(k,{children:e.jsx(B,{sx:{width:"100%"},children:e.jsx(le,{onSelect:o,style:{width:"100%"}})})}),e.jsx(R,{children:e.jsx(f,{onClick:u,color:"primary",children:"Close"})})]})]})}z.propTypes={onSelect:W.func};function A({onSelect:p}){const[j,h]=a.useState(!1),r=()=>{h(!0)},u=()=>{h(!1)},o=x=>{p(x),u()};return e.jsxs("div",{children:[e.jsx(f,{variant:"outlined",onClick:r,children:"Set"}),e.jsxs(F,{open:j,onClose:u,maxWidth:"xl",fullWidth:!0,children:[e.jsx(L,{children:"Customers"}),e.jsx(k,{sx:{padding:0},children:e.jsx(B,{sx:{width:"100%"},children:e.jsx(ie,{onSelect:o,style:{width:"100%"}})})}),e.jsx(R,{children:e.jsx(f,{onClick:u,color:"primary",children:"Close"})})]})]})}A.propTypes={onSelect:W.func};function me(){const p=re(),[j,h]=a.useState(!1),[r,u]=a.useState({id:0,name:"",street:"",city:"",state:"",country:"",zip:"",phone:"",mobile:"",email:""}),[o,x]=a.useState([]),[C,D]=a.useState({}),[E,N]=a.useState(0),[U,$]=a.useState(0),[I,M]=a.useState(0),[v,Q]=a.useState(""),[S,G]=a.useState(""),V=(t,n)=>{console.log("Fetching order totals");const l=`${O.baseURL}/api-proxy/proxy?method=post&resource=ordertotals`;console.log(l);const s=o.map(i=>({product_id:i.id,product_uom_qty:i.product_uom_qty})),m={partner_id:r.id,order_line:s};console.log("Request body",m),T.post(l,m,{headers:{Authorization:`Bearer ${w.get("jwt")}`}}).then(i=>{console.log(i.data),D(i.data.result.product_prices),N(i.data.result.subtotal),$(i.data.result.total)}).catch(i=>{console.error("Error fetching order totals:",i)})};a.useEffect(()=>{V();const t=o.reduce((n,l)=>n+l.product_uom_qty,0);M(t)},[r,o]);const H=(t,n,l)=>{if(t<0||t>=o.length)return;const s=o.filter((m,i)=>i!==t);x(s)},X=(t,n)=>{const l=o.map((s,m)=>m===t?{...s,product_uom_qty:n!==0?Number(n):0}:s);x(l)},y=t=>t?`$${t.toFixed(2)}`:"",J=t=>{console.log("Setting order partner"),console.log(t),u({id:t.id,name:t.name,street:t.street,city:t.city,state:t.state,country:t.country,zip:t.zip,phone:t.phone,mobile:t.mobile,email:t.email})},K=t=>{console.log("Adding order line"),console.log(t),x([...o,{id:t.id,name:t.name,default_code:t.default_code,category:t.category,type:t.type,lst_price:t.lst_price,invoice_policy:t.invoice_policy,description_sale:t.description_sale,sale_ok:t.sale_ok,purchase_ok:t.purchase_ok,sales_count:t.sales_count,product_uom_qty:1}])},Y=t=>{Q(t.target.value)},Z=t=>{G(t.target.value)},ee=()=>{h(!0),console.log("Creating an order");const t=`${O.baseURL}/api-proxy/proxy?method=post&resource=orders`;console.log(t),console.log(o);const n=o.map(s=>({product_id:s.id,product_uom_qty:s.product_uom_qty}));console.log(n);const l={order:{partner_id:r.id,order_line:n,x_studio_notes:v,client_order_ref:S}};console.log("Request body",l),T.post(t,l,{headers:{Authorization:`Bearer ${w.get("jwt")}`}}).then(s=>{console.log(s.data),h(!1),p.push(`/orders/${s.data.result.sale_order_id}`)}).catch(s=>{console.error("Error fetching customers:",s)})},te=e.jsxs(e.Fragment,{children:[e.jsx(P,{spacing:3,direction:"row",alignItems:"center",children:e.jsx(_,{fullWidth:!0,name:"partner_id",label:"Customer",value:r.name,InputProps:{readOnly:!0,endAdornment:e.jsx(b,{children:e.jsx(A,{onSelect:J})})}})}),r.name&&e.jsxs(e.Fragment,{children:[e.jsx("div",{style:{margin:"16px 0"}}),e.jsx(d,{variant:"body1",fontWeight:"bold",children:"Address:"}),e.jsx(d,{variant:"body1",children:r.street}),e.jsxs(d,{variant:"body1",children:[r.city," ",r.state]}),e.jsxs(d,{variant:"body1",children:[r.country," ",r.zip]}),e.jsxs(d,{variant:"body1",children:[e.jsx("b",{children:"Phone:"})," ",r.phone]}),e.jsxs(d,{variant:"body1",children:[e.jsx("b",{children:"Mobile:"})," ",r.mobile]}),e.jsxs(d,{variant:"body1",children:[e.jsx("b",{children:"Email:"})," ",r.email]})]}),e.jsx("div",{style:{margin:"16px 0"}}),e.jsx(b,{children:e.jsx(z,{onSelect:K})}),e.jsx("div",{style:{margin:"16px 0"}}),e.jsx(de,{component:oe,children:e.jsxs(ce,{children:[e.jsx(ue,{children:e.jsxs(q,{children:[e.jsx(c,{children:"Product"}),e.jsx(c,{children:"Unit Price"}),e.jsx(c,{children:"Qty"}),e.jsx(c,{children:"Subtotal"}),e.jsx(c,{})]})}),e.jsx(he,{children:o.map((t,n)=>e.jsxs(q,{children:[e.jsxs(c,{children:["[",t.default_code,"] ",t.name]}),e.jsx(c,{children:y(C[t.id])}),e.jsx(c,{children:e.jsx(_,{type:"number",style:{minWidth:"100px"},value:t.product_uom_qty!==0?t.product_uom_qty:"",onChange:l=>X(n,l.target.value)})}),e.jsx(c,{children:y(C[t.id]*t.product_uom_qty)}),e.jsx(c,{align:"right",children:e.jsx(b,{onClick:()=>H(n),children:e.jsx(se,{icon:"eva:trash-2-outline"})})})]},n))})]})}),e.jsx("div",{style:{margin:"16px 0"}}),e.jsxs(d,{variant:"body1",fontWeight:"bold",children:["Total Product Qty: ",I]}),e.jsxs(d,{variant:"body1",fontWeight:"bold",children:["Subtotal: ",y(E)]}),e.jsxs(d,{variant:"body1",fontWeight:"bold",children:["Total: ",y(U)]}),e.jsx("div",{style:{margin:"16px 0"}}),e.jsx(g,{container:!0,spacing:2,children:e.jsx(g,{item:!0,xs:12,md:6,lg:6,children:e.jsx(_,{label:"Notes",value:v,multiline:!0,fullWidth:!0,rows:4,onChange:Y})})}),e.jsx("div",{style:{margin:"16px 0"}}),e.jsx(g,{container:!0,spacing:2,children:e.jsx(g,{item:!0,xs:12,md:6,lg:6,children:e.jsx(_,{label:"PO Number",value:S,fullWidth:!0,onChange:Z})})}),e.jsx("div",{style:{margin:"16px 0"}}),e.jsx(ae,{fullWidth:!0,size:"large",type:"submit",variant:"contained",color:"inherit",onClick:ee,loading:j,children:"Create"})]});return e.jsxs(xe,{children:[e.jsx(P,{direction:"row",alignItems:"center",justifyContent:"space-between",mb:5,children:e.jsx(d,{variant:"h4",children:"New Order"})}),te,e.jsx(pe,{})]})}function Oe(){return je(),e.jsxs(e.Fragment,{children:[e.jsx(ne,{children:e.jsx("title",{children:" New Order | BEX Sales "})}),e.jsx(me,{})]})}export{Oe as default};
