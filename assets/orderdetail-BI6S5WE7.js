import{g as pe,k as me,h as je,T as p,M as ge,r as n,i as ye,a as fe,j as e,_ as H,b as Ce,f as _e,x as _,P,S as L,y as T,z as Q,C as w,F as D,G as be,E as q,N as Se,W as ve}from"./index-D2TG5Gbs.js";import{P as Oe}from"./product-view-Km8zEJGi.js";import{D as F,a as R,b as W,c as U,G as v}from"./Grid-B9JLSM4P.js";import{F as X,T as O,L as Te}from"./LoadingButton-B-qPNzwV.js";import{C as Pe}from"./customer-view-DN-kE0wr.js";import{d as we,e as De,b as qe,T as V,a as j,f as Le}from"./search-fill-DYlfUxKI.js";import{C as Fe}from"./Container-CilWZ7bv.js";import{C as Re}from"./Card-50y2-TB9.js";import{u as We}from"./use-auth-a8bhF03i.js";import"./Select-EqYqUqnI.js";import"./isMuiElement-CYNggTAb.js";function Ue(r){return pe("MuiDialogContentText",r)}me("MuiDialogContentText",["root"]);const $e=["children","className"],ke=r=>{const{classes:a}=r,d=_e({root:["root"]},Ue,a);return H({},a,d)},Ae=je(p,{shouldForwardProp:r=>ge(r)||r==="classes",name:"MuiDialogContentText",slot:"Root",overridesResolver:(r,a)=>a.root})({}),Me=n.forwardRef(function(a,l){const d=ye({props:a,name:"MuiDialogContentText"}),{className:i}=d,g=fe(d,$e),y=ke(g);return e.jsx(Ae,H({component:"p",variant:"body1",color:"text.secondary",ref:l,ownerState:g,className:Ce(y.root,i)},d,{classes:y}))}),Ne=Me;function J({onSelect:r}){const[a,l]=n.useState(!1),d=()=>{l(!0)},i=()=>{l(!1)},g=y=>{r(y),i()};return e.jsxs("div",{children:[e.jsx(_,{variant:"outlined",onClick:d,children:"Add Product"}),e.jsxs(F,{open:a,onClose:i,maxWidth:"xl",fullWidth:!0,children:[e.jsx(R,{children:"Products"}),e.jsx(W,{children:e.jsx(X,{sx:{width:"100%"},children:e.jsx(Oe,{onSelect:g,style:{width:"100%"}})})}),e.jsx(U,{children:e.jsx(_,{onClick:i,color:"primary",children:"Close"})})]})]})}J.propTypes={onSelect:P.func};function K({onSelect:r}){const[a,l]=n.useState(!1),d=()=>{l(!0)},i=()=>{l(!1)},g=y=>{r(y),i()};return e.jsxs("div",{children:[e.jsx(_,{variant:"outlined",onClick:d,children:"Set"}),e.jsxs(F,{open:a,onClose:i,maxWidth:"xl",fullWidth:!0,children:[e.jsx(R,{children:"Customers"}),e.jsx(W,{sx:{padding:0},children:e.jsx(X,{sx:{width:"100%"},children:e.jsx(Pe,{onSelect:g,style:{width:"100%"}})})}),e.jsx(U,{children:e.jsx(_,{onClick:i,color:"primary",children:"Close"})})]})]})}K.propTypes={onSelect:P.func};function Y({handleCancelOrder:r}){const[a,l]=n.useState(!1),d=()=>{l(!0)},i=()=>{l(!1)};return e.jsxs(L,{direction:"row",alignItems:"center",children:[e.jsx(p,{variant:"body1",sx:{color:"red"},children:"Cancel"}),e.jsxs(T,{onClick:d,sx:{color:"red"},children:[e.jsx(Q,{icon:"eva:close-outline"})," "]}),e.jsxs(F,{open:a,onClose:i,"aria-labelledby":"alert-dialog-title","aria-describedby":"alert-dialog-description",children:[e.jsx(R,{id:"alert-dialog-title",children:"Confirm Cancellation"}),e.jsx(W,{children:e.jsx(Ne,{id:"alert-dialog-description",children:"Are you sure you want to cancel this order?"})}),e.jsxs(U,{children:[e.jsx(_,{onClick:i,color:"primary",children:"Cancel"}),e.jsx(_,{onClick:r,color:"primary",autoFocus:!0,children:"Confirm"})]})]})]})}Y.propTypes={handleCancelOrder:P.func};function Z({orderId:r}){const[a,l]=n.useState(!1),[d,i]=n.useState(""),[g,y]=n.useState(""),[c,$]=n.useState({id:0,name:"",street:"",city:"",state:"",country:"",zip:"",phone:"",mobile:"",email:""}),[m,b]=n.useState([]),[k,ee]=n.useState([]),[A,te]=n.useState({}),[oe,M]=n.useState(0),[re,N]=n.useState(0),[B,E]=n.useState(""),[z,I]=n.useState("");n.useEffect(()=>{ce()},[]);const se=()=>{G(!0)},ne=(t,o)=>{console.log("Fetching order totals");const u=`${q.baseURL}/api-proxy/proxy?method=post&resource=ordertotals`;console.log(u);const s=m.map(h=>({product_id:h[2].id,product_uom_qty:h[2].product_uom_qty})),f={partner_id:c.id,order_line:s};console.log("Request body",f),w.post(u,f,{headers:{Authorization:`Bearer ${D.get("jwt")}`}}).then(h=>{console.log(h.data),te(h.data.result.product_prices),M(h.data.result.subtotal),N(h.data.result.total)}).catch(h=>{console.error("Error fetching order totals:",h)})};n.useEffect(()=>{ne()},[c,m]);const ae=t=>{E(t.target.value)},le=t=>{I(t.target.value)},G=t=>{l(!0),console.log("Saving Order");let o="post";t===!0&&(o="cancel");const u=`${q.baseURL}/api-proxy/proxy?method=${o}&resource=orders`;console.log(u),console.log(m);const s=m.map(x=>[x[0],x[1],{product_id:x[2].id,product_uom_qty:x[2].product_uom_qty}]),f=k.map(x=>[2,x[1],{}]),h=s.concat(f),C={order:{id:parseInt(r,10),partner_id:c.id,order_line:h,x_studio_notes:B,client_order_ref:z}};console.log("Request body",C),w.post(u,C,{headers:{Authorization:`Bearer ${D.get("jwt")}`}}).then(x=>{console.log(x.data),l(!1),x.data.result.success===!1?alert(x.data.result.message):window.location.reload()}).catch(x=>{console.error("Error saving order:",x)})},ie=(t,o,u)=>{if(t<0||t>=m.length)return;const s=m.filter((h,C)=>C===t);s[0][0]!==0&&(console.log("Adding line to delete queue",s),ee(k.concat(s)));const f=m.filter((h,C)=>C!==t);b(f)},de=(t,o)=>{const u=m.map((s,f)=>f===t?(console.log("handle qty change",s),[s[0],s[1],{...s[2],product_uom_qty:o!==0?Number(o):0}]):s);b(u)},S=t=>t?`$${t.toFixed(2)}`:"",ce=()=>{console.log("Fetching Order Details");const t=`${q.baseURL}/api-proxy/proxy?method=get&resource=orders&order_id=${r}`;console.log(t),w.get(t,{headers:{Authorization:`Bearer ${D.get("jwt")}`}}).then(o=>{console.log(o.data.data),i(o.data.data.name),$(o.data.data.customer_id),E(o.data.data.x_studio_notes),I(o.data.data.client_order_ref?o.data.data.client_order_ref:"");const u=o.data.data.order_line.map(s=>[1,s.id,{line_id:s.id,id:s.product_id.id,name:s.name,product_uom_qty:s.product_uom_qty}]);console.log(u),b(u),M(o.data.data.amount_untaxed),N(o.data.data.amount_total),y(o.data.data.state)}).catch(o=>{console.error("Error fetching order details:",o)})},ue=t=>{console.log("Setting order partner"),console.log(t),$({id:t.id,name:t.name,street:t.street,city:t.city,state:t.state,country:t.country,zip:t.zip,phone:t.phone,mobile:t.mobile,email:t.email})},he=t=>{console.log("Adding order line"),console.log(t),b([...m,[0,0,{id:t.id,name:`[${t.default_code}] ${t.name}`,product_uom_qty:1}]])},xe=e.jsxs(e.Fragment,{children:[e.jsx(L,{spacing:3,direction:"row",alignItems:"center",children:e.jsx(O,{fullWidth:!0,name:"partner_id",label:"Customer",value:c.name,InputProps:{readOnly:!0,endAdornment:e.jsx(T,{children:e.jsx(K,{onSelect:ue})})}})}),c.name&&e.jsxs(e.Fragment,{children:[e.jsx("div",{style:{margin:"16px 0"}}),e.jsx(p,{variant:"body1",fontWeight:"bold",children:"Address:"}),e.jsx(p,{variant:"body1",children:c.street}),e.jsxs(p,{variant:"body1",children:[c.city," ",c.state]}),e.jsxs(p,{variant:"body1",children:[c.country," ",c.zip]}),e.jsxs(p,{variant:"body1",children:[e.jsx("b",{children:"Phone:"})," ",c.phone]}),e.jsxs(p,{variant:"body1",children:[e.jsx("b",{children:"Mobile:"})," ",c.mobile]}),e.jsxs(p,{variant:"body1",children:[e.jsx("b",{children:"Email:"})," ",c.email]})]}),e.jsx(T,{children:e.jsx(J,{onSelect:he})}),e.jsx("div",{style:{margin:"16px 0"}}),e.jsx(we,{component:be,children:e.jsxs(De,{children:[e.jsx(qe,{children:e.jsxs(V,{children:[e.jsx(j,{children:"Product"}),e.jsx(j,{children:"Unit Price"}),e.jsx(j,{children:"Qty"}),e.jsx(j,{children:"Subtotal"}),e.jsx(j,{})]})}),e.jsx(Le,{children:m.map((t,o)=>e.jsxs(V,{children:[e.jsx(j,{children:t[2].name}),e.jsx(j,{children:S(A[t[2].id])}),e.jsx(j,{children:e.jsx(O,{type:"number",style:{minWidth:"100px"},value:t[2].product_uom_qty!==0?t[2].product_uom_qty:"",onChange:u=>de(o,u.target.value)})}),e.jsx(j,{children:S(A[t[2].id]*t[2].product_uom_qty)}),e.jsx(j,{align:"right",children:e.jsx(T,{onClick:()=>ie(o),children:e.jsx(Q,{icon:"eva:trash-2-outline"})})})]},o))})]})}),e.jsx("div",{style:{margin:"16px 0"}}),e.jsxs(p,{variant:"body1",fontWeight:"bold",children:["Subtotal: ",S(oe)]}),e.jsxs(p,{variant:"body1",fontWeight:"bold",children:["Total: ",S(re)]}),e.jsx("div",{style:{margin:"16px 0"}}),e.jsx(v,{container:!0,spacing:2,children:e.jsx(v,{item:!0,xs:12,md:6,lg:6,children:e.jsx(O,{label:"Notes",value:B,multiline:!0,fullWidth:!0,rows:4,onChange:ae})})}),e.jsx("div",{style:{margin:"16px 0"}}),e.jsx(v,{container:!0,spacing:2,children:e.jsx(v,{item:!0,xs:12,md:6,lg:6,children:e.jsx(O,{label:"PO Number",value:z,fullWidth:!0,onChange:le})})}),e.jsx("div",{style:{margin:"16px 0"}}),e.jsx(Te,{fullWidth:!0,size:"large",type:"submit",variant:"contained",color:"inherit",onClick:G,loading:a,children:"Save"})]});return e.jsxs(Fe,{children:[e.jsxs(L,{direction:"row",alignItems:"center",justifyContent:"space-between",mb:5,children:[e.jsxs(p,{variant:"h4",children:["Order ",d," [",g,"]"]}),g==="draft"&&e.jsx(Y,{handleCancelOrder:se})]}),xe,e.jsx(Re,{})]})}Z.propTypes={orderId:P.any};function Ye(){We();const{orderId:r}=Se();return e.jsxs(e.Fragment,{children:[e.jsx(ve,{children:e.jsx("title",{children:" Order Detail | BEX Sales "})}),e.jsx(Z,{orderId:r})]})}export{Ye as default};
