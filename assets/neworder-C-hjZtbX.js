import{r as a,j as e,x as _,P as W,w as ee,S as P,y as b,T as d,G as te,z as re,C as T,F as w,E as O,W as oe}from"./index-D2TG5Gbs.js";import{P as se}from"./product-view-Km8zEJGi.js";import{D as F,a as L,b as k,c as R,G as y}from"./Grid-B9JLSM4P.js";import{F as B,T as f,L as ne}from"./LoadingButton-B-qPNzwV.js";import{C as le}from"./customer-view-DN-kE0wr.js";import{d as ae,e as ie,b as de,T as q,a as c,f as ce}from"./search-fill-DYlfUxKI.js";import{C as ue}from"./Container-CilWZ7bv.js";import{C as he}from"./Card-50y2-TB9.js";import{u as xe}from"./use-auth-a8bhF03i.js";import"./Select-EqYqUqnI.js";import"./isMuiElement-CYNggTAb.js";function z({onSelect:p}){const[j,h]=a.useState(!1),r=()=>{h(!0)},u=()=>{h(!1)},s=x=>{p(x),u()};return e.jsxs("div",{children:[e.jsx(_,{variant:"outlined",onClick:r,children:"Add Product"}),e.jsxs(F,{open:j,onClose:u,maxWidth:"xl",fullWidth:!0,children:[e.jsx(L,{children:"Products"}),e.jsx(k,{children:e.jsx(B,{sx:{width:"100%"},children:e.jsx(se,{onSelect:s,style:{width:"100%"}})})}),e.jsx(R,{children:e.jsx(_,{onClick:u,color:"primary",children:"Close"})})]})]})}z.propTypes={onSelect:W.func};function A({onSelect:p}){const[j,h]=a.useState(!1),r=()=>{h(!0)},u=()=>{h(!1)},s=x=>{p(x),u()};return e.jsxs("div",{children:[e.jsx(_,{variant:"outlined",onClick:r,children:"Set"}),e.jsxs(F,{open:j,onClose:u,maxWidth:"xl",fullWidth:!0,children:[e.jsx(L,{children:"Customers"}),e.jsx(k,{sx:{padding:0},children:e.jsx(B,{sx:{width:"100%"},children:e.jsx(le,{onSelect:s,style:{width:"100%"}})})}),e.jsx(R,{children:e.jsx(_,{onClick:u,color:"primary",children:"Close"})})]})]})}A.propTypes={onSelect:W.func};function pe(){const p=ee(),[j,h]=a.useState(!1),[r,u]=a.useState({id:0,name:"",street:"",city:"",state:"",country:"",zip:"",phone:"",mobile:"",email:""}),[s,x]=a.useState([]),[C,D]=a.useState({}),[E,N]=a.useState(0),[U,$]=a.useState(0),[v,I]=a.useState(""),[S,M]=a.useState(""),G=(t,n)=>{console.log("Fetching order totals");const i=`${O.baseURL}/api-proxy/proxy?method=post&resource=ordertotals`;console.log(i);const o=s.map(l=>({product_id:l.id,product_uom_qty:l.product_uom_qty})),m={partner_id:r.id,order_line:o};console.log("Request body",m),T.post(i,m,{headers:{Authorization:`Bearer ${w.get("jwt")}`}}).then(l=>{console.log(l.data),D(l.data.result.product_prices),N(l.data.result.subtotal),$(l.data.result.total)}).catch(l=>{console.error("Error fetching order totals:",l)})};a.useEffect(()=>{G()},[r,s]);const V=(t,n,i)=>{if(t<0||t>=s.length)return;const o=s.filter((m,l)=>l!==t);x(o)},H=(t,n)=>{const i=s.map((o,m)=>m===t?{...o,product_uom_qty:n!==0?Number(n):0}:o);x(i)},g=t=>t?`$${t.toFixed(2)}`:"",Q=t=>{console.log("Setting order partner"),console.log(t),u({id:t.id,name:t.name,street:t.street,city:t.city,state:t.state,country:t.country,zip:t.zip,phone:t.phone,mobile:t.mobile,email:t.email})},X=t=>{console.log("Adding order line"),console.log(t),x([...s,{id:t.id,name:t.name,default_code:t.default_code,category:t.category,type:t.type,lst_price:t.lst_price,invoice_policy:t.invoice_policy,description_sale:t.description_sale,sale_ok:t.sale_ok,purchase_ok:t.purchase_ok,sales_count:t.sales_count,product_uom_qty:1}])},J=t=>{I(t.target.value)},K=t=>{M(t.target.value)},Y=()=>{h(!0),console.log("Creating an order");const t=`${O.baseURL}/api-proxy/proxy?method=post&resource=orders`;console.log(t),console.log(s);const n=s.map(o=>({product_id:o.id,product_uom_qty:o.product_uom_qty}));console.log(n);const i={order:{partner_id:r.id,order_line:n,x_studio_notes:v,client_order_ref:S}};console.log("Request body",i),T.post(t,i,{headers:{Authorization:`Bearer ${w.get("jwt")}`}}).then(o=>{console.log(o.data),h(!1),p.push(`/orders/${o.data.result.sale_order_id}`)}).catch(o=>{console.error("Error fetching customers:",o)})},Z=e.jsxs(e.Fragment,{children:[e.jsx(P,{spacing:3,direction:"row",alignItems:"center",children:e.jsx(f,{fullWidth:!0,name:"partner_id",label:"Customer",value:r.name,InputProps:{readOnly:!0,endAdornment:e.jsx(b,{children:e.jsx(A,{onSelect:Q})})}})}),r.name&&e.jsxs(e.Fragment,{children:[e.jsx("div",{style:{margin:"16px 0"}}),e.jsx(d,{variant:"body1",fontWeight:"bold",children:"Address:"}),e.jsx(d,{variant:"body1",children:r.street}),e.jsxs(d,{variant:"body1",children:[r.city," ",r.state]}),e.jsxs(d,{variant:"body1",children:[r.country," ",r.zip]}),e.jsxs(d,{variant:"body1",children:[e.jsx("b",{children:"Phone:"})," ",r.phone]}),e.jsxs(d,{variant:"body1",children:[e.jsx("b",{children:"Mobile:"})," ",r.mobile]}),e.jsxs(d,{variant:"body1",children:[e.jsx("b",{children:"Email:"})," ",r.email]})]}),e.jsx("div",{style:{margin:"16px 0"}}),e.jsx(b,{children:e.jsx(z,{onSelect:X})}),e.jsx("div",{style:{margin:"16px 0"}}),e.jsx(ae,{component:te,children:e.jsxs(ie,{children:[e.jsx(de,{children:e.jsxs(q,{children:[e.jsx(c,{children:"Product"}),e.jsx(c,{children:"Unit Price"}),e.jsx(c,{children:"Qty"}),e.jsx(c,{children:"Subtotal"}),e.jsx(c,{})]})}),e.jsx(ce,{children:s.map((t,n)=>e.jsxs(q,{children:[e.jsxs(c,{children:["[",t.default_code,"] ",t.name]}),e.jsx(c,{children:g(C[t.id])}),e.jsx(c,{children:e.jsx(f,{type:"number",style:{minWidth:"100px"},value:t.product_uom_qty!==0?t.product_uom_qty:"",onChange:i=>H(n,i.target.value)})}),e.jsx(c,{children:g(C[t.id]*t.product_uom_qty)}),e.jsx(c,{align:"right",children:e.jsx(b,{onClick:()=>V(n),children:e.jsx(re,{icon:"eva:trash-2-outline"})})})]},n))})]})}),e.jsx("div",{style:{margin:"16px 0"}}),e.jsxs(d,{variant:"body1",fontWeight:"bold",children:["Subtotal: ",g(E)]}),e.jsxs(d,{variant:"body1",fontWeight:"bold",children:["Total: ",g(U)]}),e.jsx("div",{style:{margin:"16px 0"}}),e.jsx(y,{container:!0,spacing:2,children:e.jsx(y,{item:!0,xs:12,md:6,lg:6,children:e.jsx(f,{label:"Notes",value:v,multiline:!0,fullWidth:!0,rows:4,onChange:J})})}),e.jsx("div",{style:{margin:"16px 0"}}),e.jsx(y,{container:!0,spacing:2,children:e.jsx(y,{item:!0,xs:12,md:6,lg:6,children:e.jsx(f,{label:"PO Number",value:S,fullWidth:!0,onChange:K})})}),e.jsx("div",{style:{margin:"16px 0"}}),e.jsx(ne,{fullWidth:!0,size:"large",type:"submit",variant:"contained",color:"inherit",onClick:Y,loading:j,children:"Create"})]});return e.jsxs(ue,{children:[e.jsx(P,{direction:"row",alignItems:"center",justifyContent:"space-between",mb:5,children:e.jsx(d,{variant:"h4",children:"New Order"})}),Z,e.jsx(he,{})]})}function Te(){return xe(),e.jsxs(e.Fragment,{children:[e.jsx(oe,{children:e.jsx("title",{children:" New Order | BEX Sales "})}),e.jsx(pe,{})]})}export{Te as default};
