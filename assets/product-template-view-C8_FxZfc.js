import{j as e,N as K,T as q,P as h,k as X,g as Z,r,h as A,Y as De,Z as ke,l as I,_ as j,i as G,t as $e,a as J,b as F,f as ee,$ as Re,A as oe,y as ne,z as ie,S as re,B as Q,x as ae,C as ue,D as we,O as We,I as _e,Q as Ae,R as Ne}from"./index-BWowYoct.js";import{T as E,a as m,d as pe,e as he,b as ge,f as xe,c as Me,s as Be,g as Ie}from"./search-fill-fGETsUc3.js";import{a as Fe,O as qe,C as Ee}from"./CircularProgress-BKlh67mL.js";import{C as de}from"./Chip-DyBknxVv.js";import{T as Oe}from"./TextField-Ckdk6zU7.js";import{C as Ue}from"./Container-BG1pNjcG.js";import{C as Ve}from"./Card-BkMS8EEI.js";const ze={border:0,margin:-1,padding:0,width:"1px",height:"1px",overflow:"hidden",position:"absolute",whiteSpace:"nowrap",clip:"rect(0 0 0 0)"};function Le(t,a,s){return t?Math.max(0,(1+t)*a-s):0}function me({query:t}){return e.jsx(E,{children:e.jsx(m,{align:"center",colSpan:6,sx:{py:3},children:e.jsxs(K,{sx:{textAlign:"center"},children:[e.jsx(q,{variant:"h6",paragraph:!0,children:"Not found"}),e.jsxs(q,{variant:"body2",children:["No results found for  ",e.jsxs("strong",{children:['"',t,'"']}),".",e.jsx("br",{})," Try checking for typos or using complete words."]})]})})})}me.propTypes={query:h.string};function fe({emptyRows:t,height:a}){return t?e.jsx(E,{sx:{...a&&{height:a*t}},children:e.jsx(m,{colSpan:9})}):null}fe.propTypes={emptyRows:h.number,height:h.number};function He(t){return Z("MuiDialog",t)}const Ye=X("MuiDialog",["root","scrollPaper","scrollBody","container","paper","paperScrollPaper","paperScrollBody","paperWidthFalse","paperWidthXs","paperWidthSm","paperWidthMd","paperWidthLg","paperWidthXl","paperFullWidth","paperFullScreen"]),se=Ye,Qe=r.createContext({}),be=Qe,Ke=["aria-describedby","aria-labelledby","BackdropComponent","BackdropProps","children","className","disableEscapeKeyDown","fullScreen","fullWidth","maxWidth","onBackdropClick","onClose","open","PaperComponent","PaperProps","scroll","TransitionComponent","transitionDuration","TransitionProps"],Xe=A(De,{name:"MuiDialog",slot:"Backdrop",overrides:(t,a)=>a.backdrop})({zIndex:-1}),Ze=t=>{const{classes:a,scroll:s,maxWidth:d,fullWidth:c,fullScreen:l}=t,u={root:["root"],container:["container",`scroll${I(s)}`],paper:["paper",`paperScroll${I(s)}`,`paperWidth${I(String(d))}`,c&&"paperFullWidth",l&&"paperFullScreen"]};return ee(u,He,a)},Ge=A(ke,{name:"MuiDialog",slot:"Root",overridesResolver:(t,a)=>a.root})({"@media print":{position:"absolute !important"}}),Je=A("div",{name:"MuiDialog",slot:"Container",overridesResolver:(t,a)=>{const{ownerState:s}=t;return[a.container,a[`scroll${I(s.scroll)}`]]}})(({ownerState:t})=>j({height:"100%","@media print":{height:"auto"},outline:0},t.scroll==="paper"&&{display:"flex",justifyContent:"center",alignItems:"center"},t.scroll==="body"&&{overflowY:"auto",overflowX:"hidden",textAlign:"center","&:after":{content:'""',display:"inline-block",verticalAlign:"middle",height:"100%",width:"0"}})),et=A(K,{name:"MuiDialog",slot:"Paper",overridesResolver:(t,a)=>{const{ownerState:s}=t;return[a.paper,a[`scrollPaper${I(s.scroll)}`],a[`paperWidth${I(String(s.maxWidth))}`],s.fullWidth&&a.paperFullWidth,s.fullScreen&&a.paperFullScreen]}})(({theme:t,ownerState:a})=>j({margin:32,position:"relative",overflowY:"auto","@media print":{overflowY:"visible",boxShadow:"none"}},a.scroll==="paper"&&{display:"flex",flexDirection:"column",maxHeight:"calc(100% - 64px)"},a.scroll==="body"&&{display:"inline-block",verticalAlign:"middle",textAlign:"left"},!a.maxWidth&&{maxWidth:"calc(100% - 64px)"},a.maxWidth==="xs"&&{maxWidth:t.breakpoints.unit==="px"?Math.max(t.breakpoints.values.xs,444):`max(${t.breakpoints.values.xs}${t.breakpoints.unit}, 444px)`,[`&.${se.paperScrollBody}`]:{[t.breakpoints.down(Math.max(t.breakpoints.values.xs,444)+32*2)]:{maxWidth:"calc(100% - 64px)"}}},a.maxWidth&&a.maxWidth!=="xs"&&{maxWidth:`${t.breakpoints.values[a.maxWidth]}${t.breakpoints.unit}`,[`&.${se.paperScrollBody}`]:{[t.breakpoints.down(t.breakpoints.values[a.maxWidth]+32*2)]:{maxWidth:"calc(100% - 64px)"}}},a.fullWidth&&{width:"calc(100% - 64px)"},a.fullScreen&&{margin:0,width:"100%",maxWidth:"100%",height:"100%",maxHeight:"none",borderRadius:0,[`&.${se.paperScrollBody}`]:{margin:0,maxWidth:"100%"}})),tt=r.forwardRef(function(a,s){const d=G({props:a,name:"MuiDialog"}),c=$e(),l={enter:c.transitions.duration.enteringScreen,exit:c.transitions.duration.leavingScreen},{"aria-describedby":u,"aria-labelledby":f,BackdropComponent:y,BackdropProps:v,children:P,className:w,disableEscapeKeyDown:D=!1,fullScreen:O=!1,fullWidth:C=!1,maxWidth:U="sm",onBackdropClick:x,onClose:k,open:N,PaperComponent:V=K,PaperProps:$={},scroll:M="paper",TransitionComponent:B=Re,transitionDuration:W=l,TransitionProps:o}=d,n=J(d,Ke),i=j({},d,{disableEscapeKeyDown:D,fullScreen:O,fullWidth:C,maxWidth:U,scroll:M}),p=Ze(i),b=r.useRef(),R=_=>{b.current=_.target===_.currentTarget},S=_=>{b.current&&(b.current=null,x&&x(_),k&&k(_,"backdropClick"))},z=Fe(f),te=r.useMemo(()=>({titleId:z}),[z]);return e.jsx(Ge,j({className:F(p.root,w),closeAfterTransition:!0,components:{Backdrop:Xe},componentsProps:{backdrop:j({transitionDuration:W,as:y},v)},disableEscapeKeyDown:D,onClose:k,open:N,ref:s,onClick:S,ownerState:i},n,{children:e.jsx(B,j({appear:!0,in:N,timeout:W,role:"presentation"},o,{children:e.jsx(Je,{className:F(p.container),onMouseDown:R,ownerState:i,children:e.jsx(et,j({as:V,elevation:24,role:"dialog","aria-describedby":u,"aria-labelledby":z},$,{className:F(p.paper,$.className),ownerState:i,children:e.jsx(be.Provider,{value:te,children:P})}))})}))}))}),at=tt;function st(t){return Z("MuiDialogActions",t)}X("MuiDialogActions",["root","spacing"]);const ot=["className","disableSpacing"],nt=t=>{const{classes:a,disableSpacing:s}=t;return ee({root:["root",!s&&"spacing"]},st,a)},it=A("div",{name:"MuiDialogActions",slot:"Root",overridesResolver:(t,a)=>{const{ownerState:s}=t;return[a.root,!s.disableSpacing&&a.spacing]}})(({ownerState:t})=>j({display:"flex",alignItems:"center",padding:8,justifyContent:"flex-end",flex:"0 0 auto"},!t.disableSpacing&&{"& > :not(style) ~ :not(style)":{marginLeft:8}})),rt=r.forwardRef(function(a,s){const d=G({props:a,name:"MuiDialogActions"}),{className:c,disableSpacing:l=!1}=d,u=J(d,ot),f=j({},d,{disableSpacing:l}),y=nt(f);return e.jsx(it,j({className:F(y.root,c),ownerState:f,ref:s},u))}),lt=rt;function ct(t){return Z("MuiDialogContent",t)}X("MuiDialogContent",["root","dividers"]);function dt(t){return Z("MuiDialogTitle",t)}const ut=X("MuiDialogTitle",["root"]),pt=ut,ht=["className","dividers"],gt=t=>{const{classes:a,dividers:s}=t;return ee({root:["root",s&&"dividers"]},ct,a)},xt=A("div",{name:"MuiDialogContent",slot:"Root",overridesResolver:(t,a)=>{const{ownerState:s}=t;return[a.root,s.dividers&&a.dividers]}})(({theme:t,ownerState:a})=>j({flex:"1 1 auto",WebkitOverflowScrolling:"touch",overflowY:"auto",padding:"20px 24px"},a.dividers?{padding:"16px 24px",borderTop:`1px solid ${(t.vars||t).palette.divider}`,borderBottom:`1px solid ${(t.vars||t).palette.divider}`}:{[`.${pt.root} + &`]:{paddingTop:0}})),mt=r.forwardRef(function(a,s){const d=G({props:a,name:"MuiDialogContent"}),{className:c,dividers:l=!1}=d,u=J(d,ht),f=j({},d,{dividers:l}),y=gt(f);return e.jsx(xt,j({className:F(y.root,c),ownerState:f,ref:s},u))}),ft=mt,bt=["className","id"],yt=t=>{const{classes:a}=t;return ee({root:["root"]},dt,a)},jt=A(q,{name:"MuiDialogTitle",slot:"Root",overridesResolver:(t,a)=>a.root})({padding:"16px 24px",flex:"0 0 auto"}),vt=r.forwardRef(function(a,s){const d=G({props:a,name:"MuiDialogTitle"}),{className:c,id:l}=d,u=J(d,bt),f=d,y=yt(f),{titleId:v=l}=r.useContext(be);return e.jsx(jt,j({component:"h2",className:F(y.root,c),ownerState:f,ref:s,variant:"h6",id:l??v},u))}),Ct=vt;function ye({open:t,onClose:a,product:s,onSelect:d}){var B,W;const[c,l]=r.useState(null),[u,f]=r.useState({}),[y,v]=r.useState("..."),[P,w]=r.useState([]),[D,O]=r.useState([]);r.useEffect(()=>{if(t&&(s!=null&&s.id)){const o=`${oe.baseURL}/api-proxy/proxy?method=get&resource=products&template_id=${s.id}&include_images=false&page_size=99999`;ne.get(o,{headers:{Authorization:`Bearer ${ie.get("jwt")}`}}).then(n=>{console.log("Fetched product variants:",n.data.data);const i=Array.isArray(n.data.data)?n.data.data:[n.data.data];O(i)}).catch(n=>console.error("Error fetching variants:",n))}},[t,s==null?void 0:s.id]);const C=r.useCallback((o,n)=>{const i={...u};return delete i[o],D.filter(b=>{const R=b.product_template_attribute_value_ids.map(S=>S.name);return Object.values(i).every(S=>R.includes(S))}).some(b=>b.product_template_attribute_value_ids.map(S=>S.name).includes(n)&&b.qty_available>0)},[D,u]),U=o=>{w(n=>n.filter(i=>i.id!==o))},x=(B=s==null?void 0:s.attributes)==null?void 0:B.every(o=>u[o.attribute]),k=r.useCallback(()=>{if(!x)return;console.log("Fetching Product Variant"),v("Searching...");const o=Object.values(u).join(",");let n=`${oe.baseURL}/api-proxy/proxy?method=get&resource=products&template_id=${s.id}`;o&&(n+=`&attributes=${o}`),n+="&include_images=true",console.log(n),ne.get(n,{headers:{Authorization:`Bearer ${ie.get("jwt")}`}}).then(i=>{console.log(i.data.data),i.data.data&&Object.keys(i.data.data).length>0?o?l(i.data.data):Array.isArray(i.data.data)&&i.data.data.length>0&&l(i.data.data[0]):(l(null),v("Product not found..."))}).catch(i=>{console.error("Error fetching products:",i)})},[x,s.id,u]);r.useEffect(()=>{x&&k()},[x,k]),r.useEffect(()=>{if(c){const o=c.product_template_attribute_value_ids.map(R=>R.name).join(","),{default_code:n,name:i,qty_available:p}=c,b=`${n?`[${n}] `:""}${i}${o?` (${o})`:""}: ${p} available`;v(b)}else v("Product not found...")},[c]);const N=(o,n)=>{f({...u,[o]:n})},V=()=>{if(!Array.isArray(P)||P.length===0){alert("You must select at least one product variant before adding to order.");return}const o=P.map(n=>({...n,attributes:n.product_template_attribute_value_ids,product_template_attribute_value_ids:void 0}));console.log("Final cleaned products to add:",o),d(o)},$=(o,n)=>{const i=parseInt(n,10);w(p=>p.map(b=>b.id===o?{...b,qty_needed:Number.isNaN(i)?"":i}:b))},M=()=>{if(!c){alert("You must have a variant selected! Please select one value for each variant.");return}const o={...c,qty_needed:1};w(n=>n.find(p=>p.id===o.id)?n.map(p=>p.id===o.id?{...p,qty_needed:p.qty_needed+1}:p):[...n,o])};return e.jsxs(at,{open:t,onClose:a,maxWidth:"lg",fullWidth:!0,children:[(s==null?void 0:s.name)&&e.jsx(Ct,{id:"product-variant-title",variant:"h6",sx:{mb:2},children:s.name}),e.jsxs(ft,{dividers:!0,sx:{maxHeight:"70vh",overflowY:"auto"},children:[(W=s==null?void 0:s.attributes)==null?void 0:W.map(o=>e.jsxs(re,{spacing:1,sx:{mb:2},children:[e.jsx(q,{variant:"subtitle1",children:o.attribute}),e.jsx(Q,{sx:{display:"flex",flexWrap:"wrap",gap:1,maxHeight:150,overflowY:"auto",border:"1px solid #ccc",padding:1,borderRadius:1},children:o.values.map((n,i)=>{const p=C(o.attribute,n[1]);return e.jsx(de,{label:n[1],clickable:p,color:u[o.attribute]===n[1]?"primary":"default",onClick:()=>p&&N(o.attribute,n[1]),disabled:!p,sx:{borderRadius:"5px",fontWeight:u[o.attribute]===n[1]?"bold":"normal",opacity:p?1:.4}},i)})})]},o.id)),y&&e.jsxs(Q,{sx:{mt:2,p:2,border:"1px solid #ccc",borderRadius:1,backgroundColor:"#f5f5f5",display:"flex",alignItems:"center",justifyContent:"space-between"},children:[e.jsx(q,{variant:"subtitle1",children:y}),e.jsx(ae,{variant:"contained",color:"primary",onClick:M,disabled:!x,children:"Add"})]}),P.length>0&&e.jsx(Q,{sx:{mt:3},children:e.jsx(pe,{component:K,children:e.jsxs(he,{children:[e.jsx(ge,{children:e.jsxs(E,{children:[e.jsx(m,{children:" ".repeat(30)}),e.jsx(m,{children:"Product"}),e.jsx(m,{children:"Attributes"}),e.jsx(m,{children:"Qty Available"}),e.jsx(m,{children:"Qty Needed"}),e.jsx(m,{})," "]})}),e.jsx(xe,{children:P.map(o=>{var n;return e.jsxs(E,{children:[e.jsx(m,{children:o.image&&e.jsx("img",{src:`data:image/png;base64,${o.image}`,alt:o.name,style:{width:"100px",height:"100px"}})}),e.jsxs(m,{children:[o.default_code?`[${o.default_code}] `:"",o.name]}),e.jsx(m,{children:(n=o.product_template_attribute_value_ids)==null?void 0:n.map(i=>e.jsx(de,{label:i.name,size:"small"},i.id))}),e.jsx(m,{children:o.qty_available}),e.jsx(m,{children:e.jsx(Oe,{type:"number",size:"small",value:o.qty_needed,onChange:i=>$(o.id,i.target.value),onBlur:i=>{const p=parseInt(i.target.value,10);(!p||p<1)&&$(o.id,1)},inputProps:{min:1}})}),e.jsx(m,{children:e.jsx(ue,{onClick:()=>U(o.id),children:e.jsx(we,{icon:"eva:trash-2-outline"})})})]},o.id)})})]})})})]}),e.jsxs(lt,{children:[e.jsx(ae,{onClick:a,children:"Cancel"}),e.jsx(ae,{onClick:V,disabled:!x,children:"Add to Order"})]})]})}ye.propTypes={open:h.bool.isRequired,onClose:h.func.isRequired,product:h.object,onSelect:h.func};function je({id:t,image:a,name:s,category:d,type:c,list_price:l,attributes:u,onSelect:f}){const y=v=>`$${v.toFixed(2)}`;return e.jsxs(E,{hover:!0,tabIndex:-1,onClick:()=>f({id:t,image:a,name:s,category:d,type:c,list_price:l,attributes:u}),children:[e.jsx(m,{children:a&&e.jsx("img",{src:`data:image/png;base64,${a}`,alt:s,style:{width:"100px",height:"100px"}})}),e.jsx(m,{children:s}),e.jsx(m,{children:d}),e.jsx(m,{children:c}),e.jsx(m,{children:y(l)})]})}je.propTypes={id:h.any,image:h.any,name:h.any,category:h.any,type:h.any,list_price:h.any,attributes:h.arrayOf(h.string),onSelect:h.func};function ve({order:t,orderBy:a,headLabel:s,onRequestSort:d}){const c=l=>u=>{d(u,l)};return e.jsx(ge,{children:e.jsx(E,{children:s.map(l=>e.jsx(m,{align:l.align||"left",sortDirection:a===l.id?t:!1,sx:{width:l.width,minWidth:l.minWidth},children:e.jsxs(Me,{hideSortIcon:!0,active:a===l.id,direction:a===l.id?t:"desc",onClick:c(l.id),children:[l.label,a===l.id?e.jsx(Q,{sx:{...ze},children:t==="desc"?"sorted descending":"sorted ascending"}):null]})},l.id))})})}ve.propTypes={order:h.oneOf(["asc","desc"]),orderBy:h.string,headLabel:h.array,onRequestSort:h.func};function Ce({filterName:t,onFilterName:a,onClickSearch:s,onHitEnter:d}){return e.jsx(We,{sx:{height:96,display:"flex",justifyContent:"space-between",p:c=>c.spacing(0,1,0,3)},children:e.jsx(qe,{value:t,onChange:a,onKeyDown:d,placeholder:"Search product...",endAdornment:e.jsx(_e,{position:"end",children:e.jsx(ue,{onClick:s,edge:"end",children:e.jsx(Ae,{icon:Be,sx:{color:"text.disabled",width:20,height:20}})})})})})}Ce.propTypes={filterName:h.string,onFilterName:h.func,onClickSearch:h.func,onHitEnter:h.func};function Pt({showTitle:t,onSelect:a}){const[s,d]=r.useState(!1),[c,l]=r.useState([]),[u,f]=r.useState(0),[y,v]=r.useState(0),[P,w]=r.useState("asc"),[D,O]=r.useState("name"),[C,U]=r.useState(""),[x,k]=r.useState(25),[N,V]=r.useState(0),[$,M]=r.useState(!1),[B,W]=r.useState(null),o=r.useRef(c),n=r.useRef(x),i=r.useRef(u),p=r.useRef(C);r.useEffect(()=>{o.current=c,n.current=x,i.current=u,p.current=C,b(i.current,n.current,o.current,p.current)},[]);const b=(g,T,L,ce)=>{console.log("Fetching Products"),d(!0);const Te=g+1;let Y=`${oe.baseURL}/api-proxy/proxy?method=get&resource=product-templates&page=${Te}&page_size=${T}`;ce&&(Y+=`&name=${ce}`),Y+="&include_images=true",console.log(Y),ne.get(Y,{headers:{Authorization:`Bearer ${ie.get("jwt")}`}}).then(H=>{console.log(H.data.data),l([...L,...H.data.data]),V(H.data.count)}).catch(H=>{console.error("Error fetching products:",H)}).finally(()=>{d(!1)})},R=(g,T)=>{T!==""&&(w(D===T&&P==="asc"?"desc":"asc"),O(T))},S=(g,T)=>{f(T);const L=x*T;window.scrollTo({top:0,behavior:"smooth"}),L>y&&(v(L),b(T,x,c,C))},z=g=>{f(0),k(parseInt(g.target.value,10))},te=g=>{U(g.target.value)},_=g=>{g.key==="Enter"&&le()},le=g=>{f(0),b(u,x,[],C)},Pe=g=>{W(g),M(!0)},Se=!c.length&&!!C;return e.jsxs(e.Fragment,{children:[s&&e.jsx(re,{sx:{position:"fixed",top:0,left:0,width:"100vw",height:"100vh",bgcolor:"rgba(255, 255, 255, 0.6)",zIndex:2e3,display:"flex",alignItems:"center",justifyContent:"center"},children:e.jsx(Ee,{})}),e.jsxs(Ue,{children:[t&&e.jsx(re,{direction:"row",alignItems:"center",justifyContent:"space-between",mb:5,children:e.jsx(q,{variant:"h4",children:"Products"})}),e.jsxs(Ve,{children:[e.jsx(Ce,{filterName:C,onFilterName:te,onClickSearch:le,onHitEnter:_}),e.jsx(Ne,{children:e.jsx(pe,{sx:{overflow:"unset"},children:e.jsxs(he,{sx:{minWidth:800},children:[e.jsx(ve,{order:P,orderBy:D,rowCount:c.length,onRequestSort:R,headLabel:[{id:"image",label:" ".repeat(30)},{id:"name",label:"Name"},{id:"category",label:"Category"},{id:"type",label:"Type"},{id:"lst_price",label:"Sale Price"}]}),e.jsxs(xe,{children:[c.slice(u*x,u*x+x).map(g=>e.jsx(je,{id:g.id,image:g.image,name:g.name,category:g.categ_id.name,type:g.type,list_price:g.list_price,attributes:g.attribute_line_ids,onSelect:Pe},g.id)),e.jsx(fe,{height:77,emptyRows:Le(u,x,c.length)}),Se&&e.jsx(me,{query:C})]})]})})}),e.jsx(Ie,{page:u,component:"div",count:N,rowsPerPage:x,onPageChange:S,rowsPerPageOptions:[25],onRowsPerPageChange:z})]}),$&&e.jsx(ye,{open:$,onClose:()=>M(!1),product:B,onSelect:a})]})]})}Pt.propTypes={showTitle:h.bool,onSelect:h.func};export{at as D,Pt as P,Ct as a,ft as b,lt as c};
